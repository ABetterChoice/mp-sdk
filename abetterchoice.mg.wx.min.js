/*! For license information please see abetterchoice.mg.wx.min.js.LICENSE */
module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s="./src/ABetterChoice.ts")}({"../../node_modules/base64-js/index.js":function(e,t,r){"use strict";t.byteLength=function(e){var t=_(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,n=_(e),a=n[0],s=n[1],E=new i(function(e,t,r){return 3*(t+r)/4-r}(0,a,s)),u=0,c=s>0?a-4:a;for(r=0;r<c;r+=4)t=o[e.charCodeAt(r)]<<18|o[e.charCodeAt(r+1)]<<12|o[e.charCodeAt(r+2)]<<6|o[e.charCodeAt(r+3)],E[u++]=t>>16&255,E[u++]=t>>8&255,E[u++]=255&t;2===s&&(t=o[e.charCodeAt(r)]<<2|o[e.charCodeAt(r+1)]>>4,E[u++]=255&t);1===s&&(t=o[e.charCodeAt(r)]<<10|o[e.charCodeAt(r+1)]<<4|o[e.charCodeAt(r+2)]>>2,E[u++]=t>>8&255,E[u++]=255&t);return E},t.fromByteArray=function(e){for(var t,r=e.length,o=r%3,i=[],a=0,s=r-o;a<s;a+=16383)i.push(u(e,a,a+16383>s?s:a+16383));1===o?(t=e[r-1],i.push(n[t>>2]+n[t<<4&63]+"==")):2===o&&(t=(e[r-2]<<8)+e[r-1],i.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return i.join("")};for(var n=[],o=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,E=a.length;s<E;++s)n[s]=a[s],o[a.charCodeAt(s)]=s;function _(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function u(e,t,r){for(var o,i,a=[],s=t;s<r;s+=3)o=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(n[(i=o)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return a.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},"../../node_modules/buffer/index.js":function(e,t,r){"use strict";(function(e){var n=r("../../node_modules/base64-js/index.js"),o=r("../../node_modules/ieee754/index.js"),i=r("../../node_modules/isarray/index.js");function a(){return E.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return E.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=E.prototype:(null===e&&(e=new E(t)),e.length=t),e}function E(e,t,r){if(!(E.TYPED_ARRAY_SUPPORT||this instanceof E))return new E(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return c(this,e)}return _(this,e,t,r)}function _(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);E.TYPED_ARRAY_SUPPORT?(e=t).__proto__=E.prototype:e=f(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!E.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|g(t,r),o=(e=s(e,n)).write(t,r);o!==n&&(e=e.slice(0,o));return e}(e,t,r):function(e,t){if(E.isBuffer(t)){var r=0|l(t.length);return 0===(e=s(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?s(e,0):f(e,t);if("Buffer"===t.type&&i(t.data))return f(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function u(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function c(e,t){if(u(t),e=s(e,t<0?0:0|l(t)),!E.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function f(e,t){var r=t.length<0?0:0|l(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function l(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function g(e,t){if(E.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return Y(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return H(e).length;default:if(n)return Y(e).length;t=(""+t).toLowerCase(),n=!0}}function p(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return b(this,t,r);case"utf8":case"utf-8":return I(this,t,r);case"ascii":return N(this,t,r);case"latin1":case"binary":return F(this,t,r);case"base64":return v(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return m(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function R(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function h(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=E.from(t,n)),E.isBuffer(t))return 0===t.length?-1:T(e,t,r,n,o);if("number"==typeof t)return t&=255,E.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):T(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function T(e,t,r,n,o){var i,a=1,s=e.length,E=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,E/=2,r/=2}function _(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(o){var u=-1;for(i=r;i<s;i++)if(_(e,i)===_(t,-1===u?0:i-u)){if(-1===u&&(u=i),i-u+1===E)return u*a}else-1!==u&&(i-=i-u),u=-1}else for(r+E>s&&(r=s-E),i=r;i>=0;i--){for(var c=!0,f=0;f<E;f++)if(_(e,i+f)!==_(t,f)){c=!1;break}if(c)return i}return-1}function d(e,t,r,n){r=Number(r)||0;var o=e.length-r;n?(n=Number(n))>o&&(n=o):n=o;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");n>i/2&&(n=i/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[r+a]=s}return a}function S(e,t,r,n){return j(Y(t,e.length-r),e,r,n)}function A(e,t,r,n){return j(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function D(e,t,r,n){return A(e,t,r,n)}function O(e,t,r,n){return j(H(t),e,r,n)}function P(e,t,r,n){return j(function(e,t){for(var r,n,o,i=[],a=0;a<e.length&&!((t-=2)<0);++a)r=e.charCodeAt(a),n=r>>8,o=r%256,i.push(o),i.push(n);return i}(t,e.length-r),e,r,n)}function v(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function I(e,t,r){r=Math.min(e.length,r);for(var n=[],o=t;o<r;){var i,a,s,E,_=e[o],u=null,c=_>239?4:_>223?3:_>191?2:1;if(o+c<=r)switch(c){case 1:_<128&&(u=_);break;case 2:128==(192&(i=e[o+1]))&&(E=(31&_)<<6|63&i)>127&&(u=E);break;case 3:i=e[o+1],a=e[o+2],128==(192&i)&&128==(192&a)&&(E=(15&_)<<12|(63&i)<<6|63&a)>2047&&(E<55296||E>57343)&&(u=E);break;case 4:i=e[o+1],a=e[o+2],s=e[o+3],128==(192&i)&&128==(192&a)&&128==(192&s)&&(E=(15&_)<<18|(63&i)<<12|(63&a)<<6|63&s)>65535&&E<1114112&&(u=E)}null===u?(u=65533,c=1):u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|1023&u),n.push(u),o+=c}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}t.Buffer=E,t.SlowBuffer=function(e){+e!=e&&(e=0);return E.alloc(+e)},t.INSPECT_MAX_BYTES=50,E.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),E.poolSize=8192,E._augment=function(e){return e.__proto__=E.prototype,e},E.from=function(e,t,r){return _(null,e,t,r)},E.TYPED_ARRAY_SUPPORT&&(E.prototype.__proto__=Uint8Array.prototype,E.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&E[Symbol.species]===E&&Object.defineProperty(E,Symbol.species,{value:null,configurable:!0})),E.alloc=function(e,t,r){return function(e,t,r,n){return u(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},E.allocUnsafe=function(e){return c(null,e)},E.allocUnsafeSlow=function(e){return c(null,e)},E.isBuffer=function(e){return!(null==e||!e._isBuffer)},E.compare=function(e,t){if(!E.isBuffer(e)||!E.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0},E.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},E.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return E.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=E.allocUnsafe(t),o=0;for(r=0;r<e.length;++r){var a=e[r];if(!E.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,o),o+=a.length}return n},E.byteLength=g,E.prototype._isBuffer=!0,E.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)R(this,t,t+1);return this},E.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)R(this,t,t+3),R(this,t+1,t+2);return this},E.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)R(this,t,t+7),R(this,t+1,t+6),R(this,t+2,t+5),R(this,t+3,t+4);return this},E.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):p.apply(this,arguments)},E.prototype.equals=function(e){if(!E.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===E.compare(this,e)},E.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},E.prototype.compare=function(e,t,r,n,o){if(!E.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),t<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&t>=r)return 0;if(n>=o)return-1;if(t>=r)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),s=Math.min(i,a),_=this.slice(n,o),u=e.slice(t,r),c=0;c<s;++c)if(_[c]!==u[c]){i=_[c],a=u[c];break}return i<a?-1:a<i?1:0},E.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},E.prototype.indexOf=function(e,t,r){return h(this,e,t,r,!0)},E.prototype.lastIndexOf=function(e,t,r){return h(this,e,t,r,!1)},E.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var o=this.length-t;if((void 0===r||r>o)&&(r=o),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return d(this,e,t,r);case"utf8":case"utf-8":return S(this,e,t,r);case"ascii":return A(this,e,t,r);case"latin1":case"binary":return D(this,e,t,r);case"base64":return O(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},E.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function N(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(127&e[o]);return n}function F(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(e[o]);return n}function b(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var o="",i=t;i<r;++i)o+=K(e[i]);return o}function m(e,t,r){for(var n=e.slice(t,r),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}function L(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function V(e,t,r,n,o,i){if(!E.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function y(e,t,r,n){t<0&&(t=65535+t+1);for(var o=0,i=Math.min(e.length-r,2);o<i;++o)e[r+o]=(t&255<<8*(n?o:1-o))>>>8*(n?o:1-o)}function C(e,t,r,n){t<0&&(t=4294967295+t+1);for(var o=0,i=Math.min(e.length-r,4);o<i;++o)e[r+o]=t>>>8*(n?o:3-o)&255}function M(e,t,r,n,o,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function x(e,t,r,n,i){return i||M(e,0,r,4),o.write(e,t,r,n,23,4),r+4}function U(e,t,r,n,i){return i||M(e,0,r,8),o.write(e,t,r,n,52,8),r+8}E.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),E.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=E.prototype;else{var o=t-e;r=new E(o,void 0);for(var i=0;i<o;++i)r[i]=this[i+e]}return r},E.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n},E.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e+--t],o=1;t>0&&(o*=256);)n+=this[e+--t]*o;return n},E.prototype.readUInt8=function(e,t){return t||L(e,1,this.length),this[e]},E.prototype.readUInt16LE=function(e,t){return t||L(e,2,this.length),this[e]|this[e+1]<<8},E.prototype.readUInt16BE=function(e,t){return t||L(e,2,this.length),this[e]<<8|this[e+1]},E.prototype.readUInt32LE=function(e,t){return t||L(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},E.prototype.readUInt32BE=function(e,t){return t||L(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},E.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*t)),n},E.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||L(e,t,this.length);for(var n=t,o=1,i=this[e+--n];n>0&&(o*=256);)i+=this[e+--n]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},E.prototype.readInt8=function(e,t){return t||L(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},E.prototype.readInt16LE=function(e,t){t||L(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},E.prototype.readInt16BE=function(e,t){t||L(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},E.prototype.readInt32LE=function(e,t){return t||L(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},E.prototype.readInt32BE=function(e,t){return t||L(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},E.prototype.readFloatLE=function(e,t){return t||L(e,4,this.length),o.read(this,e,!0,23,4)},E.prototype.readFloatBE=function(e,t){return t||L(e,4,this.length),o.read(this,e,!1,23,4)},E.prototype.readDoubleLE=function(e,t){return t||L(e,8,this.length),o.read(this,e,!0,52,8)},E.prototype.readDoubleBE=function(e,t){return t||L(e,8,this.length),o.read(this,e,!1,52,8)},E.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||V(this,e,t,r,Math.pow(2,8*r)-1,0);var o=1,i=0;for(this[t]=255&e;++i<r&&(o*=256);)this[t+i]=e/o&255;return t+r},E.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||V(this,e,t,r,Math.pow(2,8*r)-1,0);var o=r-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+r},E.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||V(this,e,t,1,255,0),E.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},E.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||V(this,e,t,2,65535,0),E.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):y(this,e,t,!0),t+2},E.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||V(this,e,t,2,65535,0),E.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):y(this,e,t,!1),t+2},E.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||V(this,e,t,4,4294967295,0),E.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):C(this,e,t,!0),t+4},E.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||V(this,e,t,4,4294967295,0),E.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):C(this,e,t,!1),t+4},E.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var o=Math.pow(2,8*r-1);V(this,e,t,r,o-1,-o)}var i=0,a=1,s=0;for(this[t]=255&e;++i<r&&(a*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+r},E.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var o=Math.pow(2,8*r-1);V(this,e,t,r,o-1,-o)}var i=r-1,a=1,s=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+r},E.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||V(this,e,t,1,127,-128),E.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},E.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||V(this,e,t,2,32767,-32768),E.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):y(this,e,t,!0),t+2},E.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||V(this,e,t,2,32767,-32768),E.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):y(this,e,t,!1),t+2},E.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||V(this,e,t,4,2147483647,-2147483648),E.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):C(this,e,t,!0),t+4},E.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||V(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),E.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):C(this,e,t,!1),t+4},E.prototype.writeFloatLE=function(e,t,r){return x(this,e,t,!0,r)},E.prototype.writeFloatBE=function(e,t,r){return x(this,e,t,!1,r)},E.prototype.writeDoubleLE=function(e,t,r){return U(this,e,t,!0,r)},E.prototype.writeDoubleBE=function(e,t,r){return U(this,e,t,!1,r)},E.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var o,i=n-r;if(this===e&&r<t&&t<n)for(o=i-1;o>=0;--o)e[o+t]=this[o+r];else if(i<1e3||!E.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)e[o+t]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+i),t);return i},E.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!E.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=E.isBuffer(e)?e:Y(new E(e,n).toString()),s=a.length;for(i=0;i<r-t;++i)this[i+t]=a[i%s]}return this};var w=/[^+\/0-9A-Za-z-_]/g;function K(e){return e<16?"0"+e.toString(16):e.toString(16)}function Y(e,t){var r;t=t||1/0;for(var n=e.length,o=null,i=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!o){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function H(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(w,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function j(e,t,r,n){for(var o=0;o<n&&!(o+r>=t.length||o>=e.length);++o)t[o+r]=e[o];return o}}).call(this,r("../../node_modules/webpack/buildin/global.js"))},"../../node_modules/ieee754/index.js":function(e,t){t.read=function(e,t,r,n,o){var i,a,s=8*o-n-1,E=(1<<s)-1,_=E>>1,u=-7,c=r?o-1:0,f=r?-1:1,l=e[t+c];for(c+=f,i=l&(1<<-u)-1,l>>=-u,u+=s;u>0;i=256*i+e[t+c],c+=f,u-=8);for(a=i&(1<<-u)-1,i>>=-u,u+=n;u>0;a=256*a+e[t+c],c+=f,u-=8);if(0===i)i=1-_;else{if(i===E)return a?NaN:1/0*(l?-1:1);a+=Math.pow(2,n),i-=_}return(l?-1:1)*a*Math.pow(2,i-n)},t.write=function(e,t,r,n,o,i){var a,s,E,_=8*i-o-1,u=(1<<_)-1,c=u>>1,f=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,l=n?0:i-1,g=n?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(E=Math.pow(2,-a))<1&&(a--,E*=2),(t+=a+c>=1?f/E:f*Math.pow(2,1-c))*E>=2&&(a++,E/=2),a+c>=u?(s=0,a=u):a+c>=1?(s=(t*E-1)*Math.pow(2,o),a+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,o),a=0));o>=8;e[r+l]=255&s,l+=g,s/=256,o-=8);for(a=a<<o|s,_+=o;_>0;e[r+l]=255&a,l+=g,a/=256,_-=8);e[r+l-g]|=128*p}},"../../node_modules/isarray/index.js":function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},"../../node_modules/ts-md5/dist/esm/index.js":function(e,t,r){"use strict";r.r(t);var n=r("../../node_modules/ts-md5/dist/esm/md5.js");r.d(t,"Md5",(function(){return n.Md5}));var o=r("../../node_modules/ts-md5/dist/esm/md5_file_hasher.js");r.d(t,"Md5FileHasher",(function(){return o.Md5FileHasher}));var i=r("../../node_modules/ts-md5/dist/esm/parallel_hasher.js");r.d(t,"ParallelHasher",(function(){return i.ParallelHasher}))},"../../node_modules/ts-md5/dist/esm/md5.js":function(e,t,r){"use strict";r.r(t),r.d(t,"Md5",(function(){return n}));class n{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(e,t=!1){return this.onePassHasher.start().appendStr(e).end(t)}static hashAsciiStr(e,t=!1){return this.onePassHasher.start().appendAsciiStr(e).end(t)}static _hex(e){const t=n.hexChars,r=n.hexOut;let o,i,a,s;for(s=0;s<4;s+=1)for(i=8*s,o=e[s],a=0;a<8;a+=2)r[i+1+a]=t.charAt(15&o),o>>>=4,r[i+0+a]=t.charAt(15&o),o>>>=4;return r.join("")}static _md5cycle(e,t){let r=e[0],n=e[1],o=e[2],i=e[3];r+=(n&o|~n&i)+t[0]-680876936|0,r=(r<<7|r>>>25)+n|0,i+=(r&n|~r&o)+t[1]-389564586|0,i=(i<<12|i>>>20)+r|0,o+=(i&r|~i&n)+t[2]+606105819|0,o=(o<<17|o>>>15)+i|0,n+=(o&i|~o&r)+t[3]-1044525330|0,n=(n<<22|n>>>10)+o|0,r+=(n&o|~n&i)+t[4]-176418897|0,r=(r<<7|r>>>25)+n|0,i+=(r&n|~r&o)+t[5]+1200080426|0,i=(i<<12|i>>>20)+r|0,o+=(i&r|~i&n)+t[6]-1473231341|0,o=(o<<17|o>>>15)+i|0,n+=(o&i|~o&r)+t[7]-45705983|0,n=(n<<22|n>>>10)+o|0,r+=(n&o|~n&i)+t[8]+1770035416|0,r=(r<<7|r>>>25)+n|0,i+=(r&n|~r&o)+t[9]-1958414417|0,i=(i<<12|i>>>20)+r|0,o+=(i&r|~i&n)+t[10]-42063|0,o=(o<<17|o>>>15)+i|0,n+=(o&i|~o&r)+t[11]-1990404162|0,n=(n<<22|n>>>10)+o|0,r+=(n&o|~n&i)+t[12]+1804603682|0,r=(r<<7|r>>>25)+n|0,i+=(r&n|~r&o)+t[13]-40341101|0,i=(i<<12|i>>>20)+r|0,o+=(i&r|~i&n)+t[14]-1502002290|0,o=(o<<17|o>>>15)+i|0,n+=(o&i|~o&r)+t[15]+1236535329|0,n=(n<<22|n>>>10)+o|0,r+=(n&i|o&~i)+t[1]-165796510|0,r=(r<<5|r>>>27)+n|0,i+=(r&o|n&~o)+t[6]-1069501632|0,i=(i<<9|i>>>23)+r|0,o+=(i&n|r&~n)+t[11]+643717713|0,o=(o<<14|o>>>18)+i|0,n+=(o&r|i&~r)+t[0]-373897302|0,n=(n<<20|n>>>12)+o|0,r+=(n&i|o&~i)+t[5]-701558691|0,r=(r<<5|r>>>27)+n|0,i+=(r&o|n&~o)+t[10]+38016083|0,i=(i<<9|i>>>23)+r|0,o+=(i&n|r&~n)+t[15]-660478335|0,o=(o<<14|o>>>18)+i|0,n+=(o&r|i&~r)+t[4]-405537848|0,n=(n<<20|n>>>12)+o|0,r+=(n&i|o&~i)+t[9]+568446438|0,r=(r<<5|r>>>27)+n|0,i+=(r&o|n&~o)+t[14]-1019803690|0,i=(i<<9|i>>>23)+r|0,o+=(i&n|r&~n)+t[3]-187363961|0,o=(o<<14|o>>>18)+i|0,n+=(o&r|i&~r)+t[8]+1163531501|0,n=(n<<20|n>>>12)+o|0,r+=(n&i|o&~i)+t[13]-1444681467|0,r=(r<<5|r>>>27)+n|0,i+=(r&o|n&~o)+t[2]-51403784|0,i=(i<<9|i>>>23)+r|0,o+=(i&n|r&~n)+t[7]+1735328473|0,o=(o<<14|o>>>18)+i|0,n+=(o&r|i&~r)+t[12]-1926607734|0,n=(n<<20|n>>>12)+o|0,r+=(n^o^i)+t[5]-378558|0,r=(r<<4|r>>>28)+n|0,i+=(r^n^o)+t[8]-2022574463|0,i=(i<<11|i>>>21)+r|0,o+=(i^r^n)+t[11]+1839030562|0,o=(o<<16|o>>>16)+i|0,n+=(o^i^r)+t[14]-35309556|0,n=(n<<23|n>>>9)+o|0,r+=(n^o^i)+t[1]-1530992060|0,r=(r<<4|r>>>28)+n|0,i+=(r^n^o)+t[4]+1272893353|0,i=(i<<11|i>>>21)+r|0,o+=(i^r^n)+t[7]-155497632|0,o=(o<<16|o>>>16)+i|0,n+=(o^i^r)+t[10]-1094730640|0,n=(n<<23|n>>>9)+o|0,r+=(n^o^i)+t[13]+681279174|0,r=(r<<4|r>>>28)+n|0,i+=(r^n^o)+t[0]-358537222|0,i=(i<<11|i>>>21)+r|0,o+=(i^r^n)+t[3]-722521979|0,o=(o<<16|o>>>16)+i|0,n+=(o^i^r)+t[6]+76029189|0,n=(n<<23|n>>>9)+o|0,r+=(n^o^i)+t[9]-640364487|0,r=(r<<4|r>>>28)+n|0,i+=(r^n^o)+t[12]-421815835|0,i=(i<<11|i>>>21)+r|0,o+=(i^r^n)+t[15]+530742520|0,o=(o<<16|o>>>16)+i|0,n+=(o^i^r)+t[2]-995338651|0,n=(n<<23|n>>>9)+o|0,r+=(o^(n|~i))+t[0]-198630844|0,r=(r<<6|r>>>26)+n|0,i+=(n^(r|~o))+t[7]+1126891415|0,i=(i<<10|i>>>22)+r|0,o+=(r^(i|~n))+t[14]-1416354905|0,o=(o<<15|o>>>17)+i|0,n+=(i^(o|~r))+t[5]-57434055|0,n=(n<<21|n>>>11)+o|0,r+=(o^(n|~i))+t[12]+1700485571|0,r=(r<<6|r>>>26)+n|0,i+=(n^(r|~o))+t[3]-1894986606|0,i=(i<<10|i>>>22)+r|0,o+=(r^(i|~n))+t[10]-1051523|0,o=(o<<15|o>>>17)+i|0,n+=(i^(o|~r))+t[1]-2054922799|0,n=(n<<21|n>>>11)+o|0,r+=(o^(n|~i))+t[8]+1873313359|0,r=(r<<6|r>>>26)+n|0,i+=(n^(r|~o))+t[15]-30611744|0,i=(i<<10|i>>>22)+r|0,o+=(r^(i|~n))+t[6]-1560198380|0,o=(o<<15|o>>>17)+i|0,n+=(i^(o|~r))+t[13]+1309151649|0,n=(n<<21|n>>>11)+o|0,r+=(o^(n|~i))+t[4]-145523070|0,r=(r<<6|r>>>26)+n|0,i+=(n^(r|~o))+t[11]-1120210379|0,i=(i<<10|i>>>22)+r|0,o+=(r^(i|~n))+t[2]+718787259|0,o=(o<<15|o>>>17)+i|0,n+=(i^(o|~r))+t[9]-343485551|0,n=(n<<21|n>>>11)+o|0,e[0]=r+e[0]|0,e[1]=n+e[1]|0,e[2]=o+e[2]|0,e[3]=i+e[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(n.stateIdentity),this}appendStr(e){const t=this._buffer8,r=this._buffer32;let o,i,a=this._bufferLength;for(i=0;i<e.length;i+=1){if(o=e.charCodeAt(i),o<128)t[a++]=o;else if(o<2048)t[a++]=192+(o>>>6),t[a++]=63&o|128;else if(o<55296||o>56319)t[a++]=224+(o>>>12),t[a++]=o>>>6&63|128,t[a++]=63&o|128;else{if(o=1024*(o-55296)+(e.charCodeAt(++i)-56320)+65536,o>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");t[a++]=240+(o>>>18),t[a++]=o>>>12&63|128,t[a++]=o>>>6&63|128,t[a++]=63&o|128}a>=64&&(this._dataLength+=64,n._md5cycle(this._state,r),a-=64,r[0]=r[16])}return this._bufferLength=a,this}appendAsciiStr(e){const t=this._buffer8,r=this._buffer32;let o,i=this._bufferLength,a=0;for(;;){for(o=Math.min(e.length-a,64-i);o--;)t[i++]=e.charCodeAt(a++);if(i<64)break;this._dataLength+=64,n._md5cycle(this._state,r),i=0}return this._bufferLength=i,this}appendByteArray(e){const t=this._buffer8,r=this._buffer32;let o,i=this._bufferLength,a=0;for(;;){for(o=Math.min(e.length-a,64-i);o--;)t[i++]=e[a++];if(i<64)break;this._dataLength+=64,n._md5cycle(this._state,r),i=0}return this._bufferLength=i,this}getState(){const e=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[e[0],e[1],e[2],e[3]]}}setState(e){const t=e.buffer,r=e.state,n=this._state;let o;for(this._dataLength=e.length,this._bufferLength=e.buflen,n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],o=0;o<t.length;o+=1)this._buffer8[o]=t.charCodeAt(o)}end(e=!1){const t=this._bufferLength,r=this._buffer8,o=this._buffer32,i=1+(t>>2);this._dataLength+=t;const a=8*this._dataLength;if(r[t]=128,r[t+1]=r[t+2]=r[t+3]=0,o.set(n.buffer32Identity.subarray(i),i),t>55&&(n._md5cycle(this._state,o),o.set(n.buffer32Identity)),a<=4294967295)o[14]=a;else{const e=a.toString(16).match(/(.*?)(.{0,8})$/);if(null===e)return;const t=parseInt(e[2],16),r=parseInt(e[1],16)||0;o[14]=t,o[15]=r}return n._md5cycle(this._state,o),e?this._state:n._hex(this._state)}}if(n.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),n.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),n.hexChars="0123456789abcdef",n.hexOut=[],n.onePassHasher=new n,"5d41402abc4b2a76b9719d911017c592"!==n.hashStr("hello"))throw new Error("Md5 self test failed.")},"../../node_modules/ts-md5/dist/esm/md5_file_hasher.js":function(e,t,r){"use strict";r.r(t),r.d(t,"Md5FileHasher",(function(){return o}));var n=r("../../node_modules/ts-md5/dist/esm/md5.js");class o{constructor(e,t=!0,r=1048576){this._callback=e,this._async=t,this._partSize=r,this._configureReader()}hash(e){this._blob=e,this._part=0,this._md5=new n.Md5,this._processPart()}_fail(){this._callback({success:!1,result:"data read failed"})}_hashData(e){let t=this;t._md5.appendByteArray(new Uint8Array(e.target.result)),t._part*t._partSize>=t._blob.size?t._callback({success:!0,result:t._md5.end()}):t._processPart()}_processPart(){const e=this;let t,r=0;e._part+=1,e._blob.size>e._partSize?(r=e._part*e._partSize,r>e._blob.size&&(r=e._blob.size),t=e._blob.slice((e._part-1)*e._partSize,r)):t=e._blob,e._async?e._reader.readAsArrayBuffer(t):setTimeout(()=>{try{e._hashData({target:{result:e._reader.readAsArrayBuffer(t)}})}catch(t){e._fail()}},0)}_configureReader(){const e=this;e._async?(e._reader=new FileReader,e._reader.onload=e._hashData.bind(e),e._reader.onerror=e._fail.bind(e),e._reader.onabort=e._fail.bind(e)):e._reader=new FileReaderSync}}},"../../node_modules/ts-md5/dist/esm/parallel_hasher.js":function(e,t,r){"use strict";r.r(t),r.d(t,"ParallelHasher",(function(){return n}));class n{constructor(e,t){this._queue=[],this._ready=!0;const r=this;Worker?(r._hashWorker=new Worker(e,t),r._hashWorker.onmessage=r._recievedMessage.bind(r),r._hashWorker.onerror=e=>{r._ready=!1}):r._ready=!1}hash(e){const t=this;let r;return r=new Promise((r,n)=>{t._queue.push({blob:e,resolve:r,reject:n}),t._processNext()}),r}terminate(){this._ready=!1,this._hashWorker.terminate()}_processNext(){this._ready&&!this._processing&&this._queue.length>0&&(this._processing=this._queue.pop(),this._hashWorker.postMessage(this._processing.blob))}_recievedMessage(e){var t,r;const n=e.data;n.success?null===(t=this._processing)||void 0===t||t.resolve(n.result):null===(r=this._processing)||void 0===r||r.reject(n.result),this._processing=void 0,this._processNext()}}},"../../node_modules/webpack/buildin/global.js":function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},"../abc_web_core/lib/constant.js":function(e,t,r){"use strict";r.r(t),r.d(t,"FETCH_URL_DEVELOP",(function(){return n})),r.d(t,"FETCH_URL_RELEASE",(function(){return o})),r.d(t,"DefaultHttpTimeout",(function(){return i})),r.d(t,"DefaultGrayId",(function(){return a})),r.d(t,"ServerDefaultGrayId",(function(){return s})),r.d(t,"TABBeaconAppKey",(function(){return E})),r.d(t,"TabAttaAppId",(function(){return _})),r.d(t,"TabAttaAppToken",(function(){return u})),r.d(t,"EXP_DATA_KEY",(function(){return c})),r.d(t,"EXP_CONTROL_DATA_KEY",(function(){return f})),r.d(t,"TAB_PROFILE_KEY_PLATFORM",(function(){return l})),r.d(t,"TAB_PROFILE_KEY_RESO",(function(){return g})),r.d(t,"TAB_PROFILE_KEY_PBRAND",(function(){return p})),r.d(t,"TAB_PROFILE_KEY_MODEL",(function(){return R})),r.d(t,"TAB_PROFILE_KEY_PLATFORM_VER",(function(){return h})),r.d(t,"TAB_PROFILE_KEY_OSMODEL",(function(){return T})),r.d(t,"TAB_PROFILE_KEY_SDKVER",(function(){return d})),r.d(t,"TAB_SDK_EVENT_RATE",(function(){return S})),r.d(t,"TAB_SDK_EVENT_ERROR_INFO",(function(){return A})),r.d(t,"RESPONSE_SUCCESS_CODE",(function(){return D})),r.d(t,"MIN_REPORT_INTERVAL",(function(){return O})),r.d(t,"DEFAULT_ROLL_INTERVAL",(function(){return P})),r.d(t,"DEFAULT_ASSIGNMENT",(function(){return v})),r.d(t,"TOGGLE_FETCH_DATA_DEFAULT_VERSION",(function(){return I})),r.d(t,"TOGGLE_CONTROL_DATA_KEY",(function(){return N})),r.d(t,"TOGGLE_DATA_KEY",(function(){return F})),r.d(t,"TOGGLE_VERSION_DATA_KEY",(function(){return b})),r.d(t,"EVENT_NETWORK_HEADER_X_AK",(function(){return m})),r.d(t,"EVENT_NETWORK_HEADER_X_ET",(function(){return L})),r.d(t,"EVENT_NETWORK_HEADER_X_ES",(function(){return V})),r.d(t,"COMMON_EVENT_PARAM_KEY_APP_ID",(function(){return y})),r.d(t,"COMMON_EVENT_PARAM_KEY_TAB_SDK_VERSION",(function(){return C})),r.d(t,"COMMON_EVENT_PARAM_KEY_USER_ID",(function(){return M})),r.d(t,"EXPOSE_EVENT_PARAM_KEY_REPORT_METHOD",(function(){return x})),r.d(t,"EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_SDK",(function(){return U})),r.d(t,"EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_USER",(function(){return w})),r.d(t,"EVENT_PROPERTIES_OS",(function(){return K})),r.d(t,"EVENT_PROPERTIES_OS_VERSION",(function(){return Y})),r.d(t,"EVENT_PROPERTIES_APP_VERSION",(function(){return H})),r.d(t,"EVENT_PROPERTIES_APP_PLATFORM",(function(){return j})),r.d(t,"EVENT_PROPERTIES_DEVICE_MODEL",(function(){return B})),r.d(t,"EVENT_PROPERTIES_MANUFACTURER",(function(){return G})),r.d(t,"EVENT_PROPERTIES_SYSTEM_LANGUAGE",(function(){return k})),r.d(t,"EVENT_PROPERTIES_NETWORK_TYPE",(function(){return $})),r.d(t,"EVENT_PROPERTIES_IP",(function(){return W})),r.d(t,"EVENT_PROPERTIES_SCREEN_WIDTH",(function(){return X})),r.d(t,"EVENT_PROPERTIES_SCREEN_HEIGHT",(function(){return q})),r.d(t,"EVENT_PROPERTIES_SCENE",(function(){return z})),r.d(t,"EVENT_PROPERTIES_MG_VERSION",(function(){return J})),r.d(t,"EVENT_PROPERTIES_MG_PLATFORM",(function(){return Z})),r.d(t,"EVENT_SDK_VERSION",(function(){return Q})),r.d(t,"EVENT_SDK_PLATFORM",(function(){return ee})),r.d(t,"EVENT_SDK_PLATFORM_DEFAULT_VAL",(function(){return te})),r.d(t,"EVENT_SDK_VERSION_DEFAULT_VAL",(function(){return re})),r.d(t,"EVENT_USER_DEVICE_ID",(function(){return ne})),r.d(t,"EVENT_USER_USER_ID",(function(){return oe})),r.d(t,"FETCH_URL_EVENT_DOMAIN_DEVELOP",(function(){return ie})),r.d(t,"FETCH_URL_EVENT_DOMAIN_RELEASE",(function(){return ae})),r.d(t,"FETCH_EXPOSURE_URL_PATH",(function(){return se})),r.d(t,"FETCH_EVENT_URL_PATH",(function(){return Ee})),r.d(t,"FETCH_EVENT_CONTROL_URL_PATH",(function(){return _e})),r.d(t,"UUID_STROAGE_KEY",(function(){return ue})),r.d(t,"LOGIN_ID_STROAGE_KEY",(function(){return ce})),r.d(t,"EVENT_COMMON_PROPERTIES_STROAGE_KEY",(function(){return fe}));const n="https://abc-minigame-test-openapi.woa.com",o="https://mobile.abetterchoice.cn",i=2e3,a=1,s=-1,E="JS0B558T33E4YJ",_="04800015034",u="6299336879",c="experiment_data_key",f="experiment_control_data_key",l="ROMA_PLATFORM",g="ROMA_RESOLUTION",p="ROMA_DEV_BRAND",R="ROMA_DEV_MODEL",h="ROMA_PLATFORM_VER",T="ROMA_OS_MODEL",d="ROMA_SDK_VERSION",S=1,A="ERROR_INFO",D=0,O=0,P=600,v="",I=0,N="toggle_control_data_key",F="toggle_data_key",b="toggle_version_data_key",m="x-ak",L="x-et",V="x-es",y="app_id",C="sdk_version",M="unit_id",x="report_method",U="1",w="0",K="#os",Y="#os_version",H="#app_version",j="#app_platform",B="#device_model",G="#manufacturer",k="#system_language",$="#network_type",W="#ip",X="#screen_width",q="#screen_height",z="#scene",J="#mg_version",Z="#mg_platform",Q="#sdk_version",ee="#sdk_platform",te="MP",re="0.0.0",ne="device_id",oe="user_id",ie="https://abc-minigame-test-openapi.woa.com",ae="https://data.abetterchoice.cn",se="/v2/exposure/log",Ee="/v2/event/log",_e="/v2/eventSetting/get",ue="abc_uuid",ce="abc_login_id",fe="abc_event_common_properties"},"../abc_web_core/lib/core/proto/type.js":function(e,t,r){"use strict";var n,o,i,a,s,E;r.r(t),r.d(t,"EventType",(function(){return n})),r.d(t,"EventStatus",(function(){return o})),r.d(t,"ExposureType",(function(){return i})),r.d(t,"EventServerCode",(function(){return a})),r.d(t,"DataUpdateType",(function(){return s})),r.d(t,"FeatureFlagResponseStatusRetCode",(function(){return E})),function(e){e[e.EVENT_TYPE_UNKNOWN=0]="EVENT_TYPE_UNKNOWN",e[e.EVENT_TYPE_EXPERIMENT=1]="EVENT_TYPE_EXPERIMENT",e[e.EVENT_TYPE_EVENT=2]="EVENT_TYPE_EVENT"}(n||(n={})),function(e){e[e.EVENT_STATUS_UNKNOWN=0]="EVENT_STATUS_UNKNOWN",e[e.EVENT_STATUS_FORMAL=1]="EVENT_STATUS_FORMAL",e[e.EVENT_STATUS_DEBUG=2]="EVENT_STATUS_DEBUG"}(o||(o={})),function(e){e[e.EXPOSURE_TYPE_UNKNOWN=0]="EXPOSURE_TYPE_UNKNOWN",e[e.EXPOSURE_TYPE_AUTOMATIC=1]="EXPOSURE_TYPE_AUTOMATIC",e[e.EXPOSURE_TYPE_MANUAL=2]="EXPOSURE_TYPE_MANUAL"}(i||(i={})),function(e){e[e.EVENT_SERVER_CODE_SUCCESS=0]="EVENT_SERVER_CODE_SUCCESS",e[e.EVENT_SERVER_CODE_NO_PERMISSION=1001]="EVENT_SERVER_CODE_NO_PERMISSION",e[e.EVENT_SERVER_CODE_TRAFFIC_LIMIT=1002]="EVENT_SERVER_CODE_TRAFFIC_LIMIT",e[e.EVENT_SERVER_CODE_INVALID_PROJECT_ID=1003]="EVENT_SERVER_CODE_INVALID_PROJECT_ID",e[e.EVENT_SERVER_CODE_SERVER_ERR=1004]="EVENT_SERVER_CODE_SERVER_ERR",e[e.EVENT_SERVER_CODE_INVALID_PARAM=1005]="EVENT_SERVER_CODE_INVALID_PARAM",e[e.EVENT_SERVER_CODE_SAME_VERSION=2001]="EVENT_SERVER_CODE_SAME_VERSION"}(a||(a={})),function(e){e[e.DATA_UPDATE_TYPE_UNKNOWN=0]="DATA_UPDATE_TYPE_UNKNOWN",e[e.DATA_UPDATE_TYPE_ALL=1]="DATA_UPDATE_TYPE_ALL",e[e.DATA_UPDATE_TYPE_NO_NEED=2]="DATA_UPDATE_TYPE_NO_NEED",e[e.DATA_UPDATE_TYPE_DIFF=3]="DATA_UPDATE_TYPE_DIFF"}(s||(s={})),function(e){e[e.RET_CODE_UNKNOWN=0]="RET_CODE_UNKNOWN",e[e.RET_CODE_SUCCESS=100]="RET_CODE_SUCCESS",e[e.RET_CODE_NO_PERMISSION=101]="RET_CODE_NO_PERMISSION",e[e.RET_CODE_TRAFFIC_LIMIT=102]="RET_CODE_TRAFFIC_LIMIT",e[e.RET_CODE_APP_ID_ERR=103]="RET_CODE_APP_ID_ERR",e[e.RET_CODE_SERVER_ERR=104]="RET_CODE_SERVER_ERR",e[e.RET_CODE_GUID_ERR=105]="RET_CODE_GUID_ERR"}(E||(E={}))},"../abc_web_core/lib/event/event_api.js":function(e,t){},"../abc_web_core/lib/event/event_component.js":function(e,t,r){"use strict";r.r(t),r.d(t,"EventComponent",(function(){return _}));var n=r("../abc_web_core/lib/constant.js"),o=r("../abc_web_core/lib/utils.js"),i=r("../abc_web_core/lib/core/proto/type.js"),a=r("../abc_web_core/lib/logger.js"),s=r("../abc_web_core/lib/event/event_constants.js"),E=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{E(n.next(e))}catch(e){i(e)}}function s(e){try{E(n.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}E((n=n.apply(e,t||[])).next())}))};class _{constructor(e){this.config=e,this.autoTrack=e.autoTrack,this.initEventComponent()}initEventComponent(){this.eventRequestVersion=s.EVENT_DATA_FETCH_DATA_DEFAULT_VERSION,this.initEventStorage(),this.initEventReport(),this.initEventFetcher()}initEventData(){return E(this,void 0,void 0,(function*(){const e=yield this.eventStorage.initEventStorageData();return a.DefaultLogger.debug("initEventData =  "+e,"autoTrack = "+this.autoTrack),e&&this.initAutoTrack(this.autoTrack),this.initEventDataTimer(),e}))}initEventDataTimer(){this.refreshEventData(this.eventRequestVersion).then(),a.DefaultLogger.debug("start eventDataTimer"),this.eventTimeInterval=setInterval(()=>{const e=this.getEventRollInterval();a.DefaultLogger.debug(`event data real refresh time : ${e}s, min 600s`),this.refreshEventData(this.eventRequestVersion).then()},1e3*this.getEventRollInterval())}getEventRollInterval(){const e=this.eventStorage.getRefreshInterval();return a.DefaultLogger.debug(`event data server refresh time getEventRollInterval = ${e}s`),Math.max(e,n.DEFAULT_ROLL_INTERVAL)}refreshEventData(e){return E(this,void 0,void 0,(function*(){return new Promise((t,r)=>{const n=this.isDefaultRequestVersion(e);a.DefaultLogger.debug("refreshEventData isEventDataDefaultVersion = "+n),this.eventFetcher.fetchEventData(e,[]).then(e=>{a.DefaultLogger.debug("refreshEventData response = ",e),this.isNeedToHandleResponse(n,e)?(a.DefaultLogger.debug("handleEventDataResponse is need to handle"),this.handleResponseEventDataVersion(e),this.handleResponseEventRefreshInterval(e),this.handleResponseEventData(n,e)):a.DefaultLogger.debug("handleEventDataResponse return by is not need")})})}))}handleResponseEventRefreshInterval(e){const t=this.eventFetcher.parseResponseRefreshInterval(e);a.DefaultLogger.debug(`handleResponseEventRefreshInterval = ${t}s`),this.eventStorage.handleResponseEventRefreshInterval(t)}handleResponseEventData(e,t){const r=this.eventFetcher.parseResponseEventCodeInfo(t);a.DefaultLogger.debug("handleResponseEventData after size = "+(null==r?void 0:r.size),r),this.eventStorage.handleResponseEventData(e,r)}isDefaultRequestVersion(e){return s.EVENT_DATA_FETCH_DATA_DEFAULT_VERSION===e}handleResponseEventDataVersion(e){const t=this.eventFetcher.parseResponseEventDataVersion(e);a.DefaultLogger.debug("handleEventDataVersion responseEventVersion = "+t),this.updateRequestEventVersion(t),this.eventStorage.handleResponseEventVersion(t)}updateRequestEventVersion(e){this.eventRequestVersion=e}isNeedToHandleResponse(e,t){if(!this.eventFetcher.isEventDataResponseSuccess(t))return a.DefaultLogger.debug("event data isNeedToHandleResponse return false is not responseSuccess"),!1;if(e)return a.DefaultLogger.debug("event data isNeedToHandleResponse return true is default request event version"),!0;const r=this.eventStorage.getEventRequestVersion(),n=this.eventFetcher.parseResponseEventDataVersion(t);return n===r?(a.DefaultLogger.debug(`isNeedToHandleResponse return false by\n        responseEventVersion not upgrade: memoryEventVersion = ${r},\n        responseEventVersion = ${n}`),!1):(a.DefaultLogger.debug(`isNeedToHandleResponse return true by\n      responseEventVersion should upgrade: memoryEventVersion = ${r},\n      responseEventVersion = ${n}`),!0)}isNeedToHandleTrack(e){const t=this.eventStorage.getEventCodeInfo(e);return void 0===t||t.isEnableReport()}initAutoTrack(e){!1!==(null==e?void 0:e.mgShow)&&this.initAutoTrackShow(),!1!==(null==e?void 0:e.mgHide)&&(this.initAutoTrackHide(),this.initEventHeartTimer()),!1!==(null==e?void 0:e.mgShare)&&this.initAutoTrackShare()}login(e){this.eventStorage.loginUser(e),a.DefaultLogger.info("登录帐号事件触发: "+e),this.track("$mgShow",{}).then(t=>{a.DefaultLogger.info(`登录帐号：${e} 事件上报: ${t}`)})}logout(){this.eventStorage.logoutUser()}clearCommonProperties(){this.eventStorage.clearCommonProperties(),this.eventTimeInterval&&(clearInterval(this.eventTimeInterval),this.eventTimeInterval=null)}getCommonProperties(){return this.eventStorage.getCommonProperties()}setCommonProperties(e){this.eventStorage.setCommonProperties(e)}unsetCommonProperty(e){this.eventStorage.unsetCommonProperty(e)}getDeviceId(){return this.eventStorage.getDeviceId()}track(e,t={},r){var s,_,u,c,f,l,g,p,R,h,T,d,S,A,D,O,P;return E(this,void 0,void 0,(function*(){const E=this.isNeedToHandleTrack(e);if(!E)return a.DefaultLogger.debug(`event = ${e} track is not needToHandleTrack = ${E} and ignore this track`),!1;const v=this.eventStorage.getSdkPropertiesMap(),I=yield this.eventStorage.getSystemPropertiesMap(),N=this.eventStorage.getUserPropertiesMap(),F=Object(o.transPropertyObjectToMap)(this.eventStorage.getCommonProperties()),b=Object(o.transPropertyObjectToMap)(t),m=new Map(F);for(const[e,t]of b)m.set(e,t);const L={eventCode:e,eventTime:r||Math.floor((new Date).getTime()/1e3),eventType:i.EventType.EVENT_TYPE_EVENT,eventStatus:1===(null===(s=this.config)||void 0===s?void 0:s.environment)?i.EventStatus.EVENT_STATUS_DEBUG:i.EventStatus.EVENT_STATUS_FORMAL,gameId:this.config.gameId,userInfo:{deviceId:null!==(_=N.get(n.EVENT_USER_DEVICE_ID))&&void 0!==_?_:"",userId:(null===(u=this.eventStorage)||void 0===u?void 0:u.getLoginId())||""},sdkInfo:{sdkVersion:null!==(c=v.get(n.EVENT_SDK_VERSION))&&void 0!==c?c:"",sdkPlatform:null!==(f=v.get(n.EVENT_SDK_PLATFORM))&&void 0!==f?f:""},propertyInfo:{osType:null!==(l=I.get(n.EVENT_PROPERTIES_OS))&&void 0!==l?l:"",osVersion:null!==(g=I.get(n.EVENT_PROPERTIES_OS_VERSION))&&void 0!==g?g:"",deviceModel:null!==(p=I.get(n.EVENT_PROPERTIES_DEVICE_MODEL))&&void 0!==p?p:"",manufacturer:null!==(R=I.get(n.EVENT_PROPERTIES_MANUFACTURER))&&void 0!==R?R:"",systemLanguage:null!==(h=I.get(n.EVENT_PROPERTIES_SYSTEM_LANGUAGE))&&void 0!==h?h:"",networkType:null!==(T=I.get(n.EVENT_PROPERTIES_NETWORK_TYPE))&&void 0!==T?T:"",clientIp:null!==(d=I.get(n.EVENT_PROPERTIES_IP))&&void 0!==d?d:"",screenWidth:null!==(S=I.get(n.EVENT_PROPERTIES_SCREEN_WIDTH))&&void 0!==S?S:0,screenHeight:null!==(A=I.get(n.EVENT_PROPERTIES_SCREEN_HEIGHT))&&void 0!==A?A:0,scene:null!==(D=I.get(n.EVENT_PROPERTIES_SCENE))&&void 0!==D?D:"",appVersion:null!==(O=I.get(n.EVENT_PROPERTIES_MG_VERSION))&&void 0!==O?O:"",appPlatform:null!==(P=I.get(n.EVENT_PROPERTIES_MG_PLATFORM))&&void 0!==P?P:""},eventValue:m};return this.eventReporter.reportEvent(L)}))}}},"../abc_web_core/lib/event/event_constants.js":function(e,t,r){"use strict";r.r(t),r.d(t,"EVENT_DATA_FETCH_DATA_DEFAULT_VERSION",(function(){return n})),r.d(t,"EVENT_DATA_FETCH_DATA_REFRESH_INTERVAL",(function(){return o})),r.d(t,"EVENT_CODE_DATA_KEY",(function(){return i})),r.d(t,"EVENT_VERSION_DATA_KEY",(function(){return a})),r.d(t,"EVENT_REFRESH_INTERVAL_DATA_KEY",(function(){return s}));const n="0",o=0,i="event_code_data_key",a="event_version_data_key",s="event_refresh_interval_data_key"},"../abc_web_core/lib/event/event_fetcher.js":function(e,t,r){"use strict";r.r(t),r.d(t,"EventDataFetcher",(function(){return _}));var n=r("../abc_web_core/lib/constant.js"),o=r("../abc_web_core/lib/logger.js"),i=r("../abc_web_core/lib/utils.js"),a=r("../abc_web_core/lib/core/proto/type.js"),s=r("../abc_web_core/lib/event/event_info.js"),E=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{E(n.next(e))}catch(e){i(e)}}function s(e){try{E(n.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}E((n=n.apply(e,t||[])).next())}))};class _{constructor(e){this.config=e,this.identifier=`_${this.config.gameId}_`}fetchEventData(e,t){return E(this,void 0,void 0,(function*(){const t=this.getEventControlDomain()+""+n.FETCH_EVENT_CONTROL_URL_PATH;o.DefaultLogger.debug(`Fetching event requestVersion ${e}, ${t}`);const r={app_id:this.config.gameId,version:e},a=Object(i.generateSignHeader)(this.config.apiKey);return yield this.sendStringRequestWithStringResponse(t,r,a)}))}isEventDataResponseSuccess(e){if(!e)return!1;const t=e.commonResp,r=a.EventServerCode[t.code];return o.DefaultLogger.debug(`isEventDataResponseSuccess：ServerResponseStatus =\n    ${r} === ${a.EventServerCode.EVENT_SERVER_CODE_SUCCESS}, message: ${t.code}`),r===a.EventServerCode.EVENT_SERVER_CODE_SUCCESS}parseResponseEventDataVersion(e){if(!e)return"";const t=e.version;return o.DefaultLogger.debug("parseResponseEventDataVersion: ServerResponseEventRequestVersion = "+t),t}parseResponseRefreshInterval(e){if(!e)return 0;const t=e.refreshInterval;return o.DefaultLogger.debug("parseResponseRefreshInterval: ServerResponseRefreshInterval = "+t),t}parseResponseEventCodeInfo(e){const t=new Map;if(!e)return t;const r=e.eventSetting;return r?(o.DefaultLogger.debug("parseResponseEventCodeSettingInfo before: size: "+Object.keys(r).length),Object.keys(r).forEach(e=>{const n=r[e];if(n){const r={isReportEnable:n.enable,eventCode:n.event_code,reportSampleValue:n.sample_interval},o=Object.assign(new s.EventCodeInfo,r);t.set(e,o)}}),o.DefaultLogger.debug("parseResponseEventCodeSettingInfo after: size: "+t.size,t),t):(o.DefaultLogger.debug(`parseResponseEventCodeSettingInfo: eventResponseData: ${r}, return empty`),t)}getEventControlDomain(){var e,t;const r=null===(e=this.config)||void 0===e?void 0:e.environment;let o=n.FETCH_URL_EVENT_DOMAIN_RELEASE;return 1===r&&(o=n.FETCH_URL_EVENT_DOMAIN_DEVELOP),(null===(t=this.config)||void 0===t?void 0:t.serverUrl)&&(o=this.config.serverUrl),o}}},"../abc_web_core/lib/event/event_info.js":function(e,t,r){"use strict";r.r(t),r.d(t,"EventCodeInfo",(function(){return n}));class n{constructor(){this.isReportEnable=!0}getEventCode(){return this.eventCode}isEnableReport(){return this.isReportEnable}getReportSampleValue(){return this.reportSampleValue}}},"../abc_web_core/lib/event/event_reporter.js":function(e,t,r){"use strict";r.r(t),r.d(t,"EventReporter",(function(){return E}));var n=r("../abc_web_core/lib/logger.js"),o=r("../abc_web_core/lib/constant.js"),i=r("../abc_web_core/lib/utils.js"),a=r("../abc_web_core/lib/core/proto/type.js"),s=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{E(n.next(e))}catch(e){i(e)}}function s(e){try{E(n.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}E((n=n.apply(e,t||[])).next())}))};class E{constructor(e){this.config=e}reportEvent(e){var t,r;return s(this,void 0,void 0,(function*(){const s=this.getEventReportDomain()+""+o.FETCH_EVENT_URL_PATH,E={device_id:(null===(t=e.userInfo)||void 0===t?void 0:t.deviceId)||"",user_id:(null===(r=e.userInfo)||void 0===r?void 0:r.userId)||"",extra_data:{}},_={version:e.sdkInfo.sdkVersion||o.EVENT_SDK_VERSION_DEFAULT_VAL,platform:e.sdkInfo.sdkPlatform||o.EVENT_SDK_PLATFORM_DEFAULT_VAL},u={os_type:e.propertyInfo.osType,os_version:e.propertyInfo.osVersion,app_version:e.propertyInfo.appVersion,app_platform:e.propertyInfo.appPlatform,device_model:e.propertyInfo.deviceModel,manufacturer:e.propertyInfo.manufacturer,system_language:e.propertyInfo.systemLanguage,network_type:e.propertyInfo.networkType,ip:e.propertyInfo.clientIp||"",scene:e.propertyInfo.scene,screen_width:e.propertyInfo.screenWidth,screen_height:e.propertyInfo.screenHeight},c={event_code:e.eventCode,event_time:e.eventTime,event_type:e.eventType||a.EventType.EVENT_TYPE_UNKNOWN,event_status:e.eventStatus,app_id:e.gameId,user:E,sdk_info:_,properties:u,event_value:Object.fromEntries(e.eventValue.entries())};n.DefaultLogger.debug(`report ${e.eventCode} event request ${s}`,c);const f=Object(i.generateSignHeader)(this.config.apiKey);return(yield this.sendStringRequestWithStringResponse(s,c,f)).code===a.EventServerCode[""+a.EventServerCode.EVENT_SERVER_CODE_SUCCESS]}))}getEventReportDomain(){var e,t;const r=null===(e=this.config)||void 0===e?void 0:e.environment;let n=o.FETCH_URL_EVENT_DOMAIN_RELEASE;return 1===r&&(n=o.FETCH_URL_EVENT_DOMAIN_DEVELOP),(null===(t=this.config)||void 0===t?void 0:t.serverUrl)&&(n=this.config.serverUrl),n}}},"../abc_web_core/lib/event/event_storage.js":function(e,t,r){"use strict";r.r(t),r.d(t,"EventStorage",(function(){return _}));var n=r("../abc_web_core/lib/logger.js"),o=r("../abc_web_core/lib/constant.js"),i=r("../abc_web_core/lib/utils.js"),a=r("../abc_web_core/lib/event/event_info.js"),s=r("../abc_web_core/lib/event/event_constants.js"),E=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{E(n.next(e))}catch(e){i(e)}}function s(e){try{E(n.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}E((n=n.apply(e,t||[])).next())}))};class _{constructor(e,t,r){this.config=e,this.sdkVersion=t,this.sdkPlatform=r,this.identifier=`_${this.config.gameId}_`,this.systemPropertiesMap=new Map,this.userPropertiesMap=new Map,this.sdkPropertiesMap=new Map,this.commonPropertyObj={},this.eventRequestVersion=s.EVENT_DATA_FETCH_DATA_DEFAULT_VERSION,this.eventRefreshInterval=s.EVENT_DATA_FETCH_DATA_REFRESH_INTERVAL,this.eventCodeInfoMap=new Map}initEventStorageData(){return E(this,void 0,void 0,(function*(){n.DefaultLogger.debug("initEventStorageData start load local all event data");try{this.systemPropertiesMap=yield this.initSystemPropertiesMap(),this.userPropertiesMap=this.initUserPropertiesMap(),this.sdkPropertiesMap=this.initSdkPropertiesMap();const e=yield this.initEventCodeData();return yield this.initEventDataVersion(),yield this.initEventRefreshInterval(),this.systemPropertiesMap.size>0&&this.userPropertiesMap.size>0&&this.sdkPropertiesMap.size>0&&e}catch(e){return n.DefaultLogger.error(e),!1}}))}getSystemPropertiesMap(){return E(this,void 0,void 0,(function*(){return this.systemPropertiesMap||(this.systemPropertiesMap=yield this.initSystemPropertiesMap()),this.systemPropertiesMap}))}getUserPropertiesMap(){return this.userPropertiesMap&&0!==this.userPropertiesMap.size||(this.userPropertiesMap=this.initUserPropertiesMap()),this.userPropertiesMap}loginUser(e){this.userPropertiesMap||(this.userPropertiesMap=this.initUserPropertiesMap()),this.saveLoginId(e)}logoutUser(){this.userPropertiesMap&&0!==this.userPropertiesMap.size||(this.userPropertiesMap=this.initUserPropertiesMap()),this.removeLoginId()}getLoginId(){var e;const t=(null===(e=this.config)||void 0===e?void 0:e.unitId)||"";if(Object(i.isStringValid)(t))return this.saveLoginId(t),t;const r=this.getStorageString(this.getInstanceStorageKey(o.LOGIN_ID_STROAGE_KEY));return this.config.unitId=r,r}setCommonProperties(e){this.commonPropertyObj=Object.assign(Object.assign({},this.getCommonProperties()),e),this.setCommonPropertiesStorage(this.commonPropertyObj)}getCommonProperties(){return 0===Object.keys(this.commonPropertyObj).length&&(this.commonPropertyObj=this.getCommonPropertiesStorage()),this.commonPropertyObj}unsetCommonProperty(e){delete this.commonPropertyObj[e],this.setCommonPropertiesStorage(this.commonPropertyObj)}clearCommonProperties(){this.commonPropertyObj={},this.removeCommonPropertiesStorage()}removeLoginId(){this.userPropertiesMap.set(o.EVENT_USER_USER_ID,""),this.removeStorageString(this.getInstanceStorageKey(o.LOGIN_ID_STROAGE_KEY))}saveLoginId(e){Object(i.isStringValid)(e)&&(this.userPropertiesMap.set(o.EVENT_USER_USER_ID,e),this.putStorageString(this.getInstanceStorageKey(o.LOGIN_ID_STROAGE_KEY),e))}getSdkPropertiesMap(){return this.sdkPropertiesMap||(this.sdkPropertiesMap=this.initSdkPropertiesMap()),this.sdkPropertiesMap}getDeviceId(){return this.getUserPropertiesMap().get(o.EVENT_USER_DEVICE_ID)||""}initUserPropertiesMap(){const e=this.getStorageString(this.getInstanceStorageKey(o.UUID_STROAGE_KEY)),t=this.getStorageString(this.getInstanceStorageKey(o.LOGIN_ID_STROAGE_KEY));n.DefaultLogger.debug(`存储UUId = ${e}, 存储storageUserId = ${t}`);const r=new Map;if(r.set(o.EVENT_USER_USER_ID,t),e)return r.set(o.EVENT_USER_DEVICE_ID,e),r;const a=Object(i.UUID)();return r.set(o.EVENT_USER_DEVICE_ID,a),this.putStorageString(this.getInstanceStorageKey(o.UUID_STROAGE_KEY),a),r}initSdkPropertiesMap(){const e=new Map;return e.set(o.EVENT_SDK_VERSION,this.sdkVersion),e.set(o.EVENT_SDK_PLATFORM,this.sdkPlatform),e}setCommonPropertiesStorage(e){return this.putStorageString(this.getInstanceStorageKey(o.EVENT_COMMON_PROPERTIES_STROAGE_KEY),e)}getCommonPropertiesStorage(){return this.getStorageString(this.getInstanceStorageKey(o.EVENT_COMMON_PROPERTIES_STROAGE_KEY))||{}}removeCommonPropertiesStorage(){return this.removeStorageString(this.getInstanceStorageKey(o.EVENT_COMMON_PROPERTIES_STROAGE_KEY))}getInstanceStorageKey(e){return this.identifier+e}initEventDataVersion(){return E(this,void 0,void 0,(function*(){try{const e=yield this.getStorageString(`_${this.identifier}_${s.EVENT_VERSION_DATA_KEY}_`);e&&e.length>0&&(this.putMemoryEventVersion(e),n.DefaultLogger.debug("initEventDataVersion: version = "+e))}catch(e){return n.DefaultLogger.error(e),!1}return!0}))}initEventRefreshInterval(){return E(this,void 0,void 0,(function*(){try{const e=yield this.getStorageString(`_${this.identifier}_${s.EVENT_REFRESH_INTERVAL_DATA_KEY}_`);e&&!isNaN(Number(e))&&(this.putMemoryEventRefreshInterval(e),n.DefaultLogger.debug("initEventRefreshInterval: eventRefreshInterval = "+e))}catch(e){return n.DefaultLogger.error(e),!1}return!0}))}initEventCodeData(){return E(this,void 0,void 0,(function*(){try{const e=yield this.getStorageAllKey();if(e){const t=`_${this.identifier}_${s.EVENT_CODE_DATA_KEY}_`.length;for(const r of e)if(r.startsWith(`_${this.identifier}_${s.EVENT_CODE_DATA_KEY}_`)){const e=yield this.getStorageString(r);if(e){const n=JSON.parse(e),o=Object.assign(new a.EventCodeInfo,n),i=r.substr(t);this.putMemoryEventCodeInfo(i,o)}}}}catch(e){return n.DefaultLogger.error(e),!1}return!0}))}getEventCodeInfo(e){var t;return null===(t=this.getMemoryEventCodeMap())||void 0===t?void 0:t.get(e)}getRefreshInterval(){return this.eventRefreshInterval}getEventRequestVersion(){return this.eventRequestVersion}putEventCodeInfo(e,t){this.putMemoryEventCodeInfo(e,t),this.putStorageEventCodeInfo(e,t)}putEventRefreshInterval(e){this.putMemoryEventRefreshInterval(e),this.putStorageEventRefreshInterval(e)}putEventVersion(e){this.putMemoryEventVersion(e),this.putStorageEventVersion(e)}putMemoryEventCodeInfo(e,t){this.eventCodeInfoMap.set(e,t)}putStorageEventCodeInfo(e,t){if(e&&t)return this.putStorageString(`_${this.identifier}_${s.EVENT_CODE_DATA_KEY}_${e}`,JSON.stringify(t))}removeMemoryEventCodeInfo(e){if(!e||0===e.length)return;this.getMemoryEventCodeMap().delete(e)}removeStorageEventCodeInfo(e){if(e&&0!==e.length)return this.removeStorageString(`_${this.identifier}_${s.EVENT_CODE_DATA_KEY}_${e}`)}putMemoryEventRefreshInterval(e){this.eventRefreshInterval=e}putStorageEventRefreshInterval(e){if(e)return this.putStorageString(`_${this.identifier}_${s.EVENT_REFRESH_INTERVAL_DATA_KEY}_`,e)}putMemoryEventVersion(e){this.eventRequestVersion=e}putStorageEventVersion(e){if(e&&0!==e.length)return this.putStorageString(`_${this.identifier}_${s.EVENT_VERSION_DATA_KEY}_`,e)}handleResponseEventRefreshInterval(e){e&&this.putEventRefreshInterval(e)}handleResponseEventVersion(e){e&&0!==e.length&&this.putEventVersion(e)}handleResponseEventData(e,t){if(0===t.size)return void n.DefaultLogger.debug("handleResponseEventData size is empty and ignore");const r=this.getMemoryEventCodeMap();n.DefaultLogger.debug("handleResponseEventData old size "+r.size),this.compareDiffForPutEventData(r,t),e&&this.compareDiffForRemoveEventData(r,t)}compareDiffForPutEventData(e,t){e&&t&&(n.DefaultLogger.debug(`compareDiffForPutEventData: memoryOldEventDataSize = ${e.size}\n    , responseEventCodeInfoMap = ${t.size}`),t.forEach((t,r)=>{const n=e.get(r);JSON.stringify(t)!=JSON.stringify(n)&&this.putEventCodeInfo(r,t)}))}compareDiffForRemoveEventData(e,t){e&&t&&e.forEach((e,r)=>{t.has(r)||this.removeEventData(r)})}removeEventData(e){this.removeMemoryEventCodeInfo(e),this.removeStorageEventCodeInfo(e)}getMemoryEventCodeMap(){return this.eventCodeInfoMap}}},"../abc_web_core/lib/experiment/exp_api.js":function(e,t){},"../abc_web_core/lib/experiment/exp_component.js":function(e,t,r){"use strict";r.r(t),r.d(t,"ExpComponent",(function(){return a}));var n=r("../abc_web_core/lib/constant.js"),o=r("../abc_web_core/lib/logger.js"),i=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{E(n.next(e))}catch(e){i(e)}}function s(e){try{E(n.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}E((n=n.apply(e,t||[])).next())}))};class a{constructor(e){this.config=e,this.initExpComponent()}initExpData(){return i(this,void 0,void 0,(function*(){const e=yield this.initExpStorageData(),t=yield this.initExpNetworkData();return o.DefaultLogger.debug(`expComponent initExpData: storageData = ${e}\n    , networkData = ${t}`),this.initExpRefreshTimer(),e&&t}))}getExperiment(e,t){var r,n;const i=this.expDataStorage.getMemoryExpDataByLayerName(e),a=null===(n=null===(r=this.config)||void 0===r?void 0:r.enableAutoExposure)||void 0===n||n,s=void 0===t?a:t;return this.reportExposeFromSDK(i,s).then(e=>{o.DefaultLogger.debug(`expComponent: getExperiment enableAutoExposure = ${a},\n      method param isNeedReport = ${t}, code report isRealNeedReport = ${s}\n       reportResult = ${e}`)}),i}getExpInfoByName(e,t){const r=this.expDataStorage.getMemoryExpDataByExpGroupKey(e),{enableAutoExposure:n}=this.config,i=void 0===t?!!n:t;return this.reportExposeFromSDK(r,i).then(e=>{o.DefaultLogger.debug(`expComponent: getExperimentByName enableAutoExposure = ${n},\n      method param isNeedReport = ${t}, reportResult = ${e}`)}),r}logExperimentExposure(e){return i(this,void 0,void 0,(function*(){return this.reportExposeFromUser(e)}))}refreshExperiment(){return i(this,void 0,void 0,(function*(){return this.refreshExpData()}))}clearExperimentSDK(){this.timeInterval&&(clearInterval(this.timeInterval),this.timeInterval=null)}initExpRefreshTimer(){const{enableAutoPoll:e}=this.config;(void 0===typeof e||e)&&(o.DefaultLogger.debug("start exp refresh timer isAutoPoll = "+e),this.timeInterval=setInterval(()=>{const e=this.getRollInterval();o.DefaultLogger.debug(`exp data refresh time roll up: ${e}s, min ${n.DEFAULT_ROLL_INTERVAL}s`),this.refreshExpData().then(e=>{o.DefaultLogger.debug("initExpRefreshTimer: refresh result = "+e)})},1e3*this.getRollInterval()))}initExpComponent(){this.initExpStorage(),this.initExpReport(),this.initExpFetcher()}initExpStorageData(){return i(this,void 0,void 0,(function*(){return this.expDataStorage.initExpStorageData()}))}initExpNetworkData(){return i(this,void 0,void 0,(function*(){try{return yield this.refreshExpData()}catch(e){return o.DefaultLogger.debug(e),!1}}))}reportExposeFromSDK(e,t){return i(this,void 0,void 0,(function*(){return!(!t||!this.isEnableReport())&&(yield this.expDataReporter.reportExposeFromSDK(e,this.getReportInterval()))}))}reportExposeFromUser(e){return i(this,void 0,void 0,(function*(){return!!this.isEnableReport()&&(yield this.expDataReporter.reportExposeFromUser(e,this.getReportInterval()))}))}isEnableReport(){const e=this.expDataStorage.isEnableReport();return o.DefaultLogger.debug("exp isEnableReport is "+e),e}getReportInterval(){const e=this.expDataStorage.getReportInterval();return o.DefaultLogger.debug(`exp getReportInterval: ${e}s`),Math.max(e,n.MIN_REPORT_INTERVAL)}getRollInterval(){const e=this.expDataStorage.getRollInterval();return o.DefaultLogger.debug(`get exp data storage rollInterval: ${e}s, min 600s`),Math.max(e,n.DEFAULT_ROLL_INTERVAL)}handleResponseControlInfo(e){const t=this.expDataFetcher.parseResponseExpControlData(e);this.expDataStorage.handleResponseControlInfo(t)}handleResponseExpData(e){const t=this.expDataFetcher.parseResponseExpData(e),r=this.expDataFetcher.parseResponseDataUpdateType(e);this.expDataStorage.handleResponseExpData(t,r)}refreshExpData(e){return i(this,void 0,void 0,(function*(){return new Promise(t=>{o.DefaultLogger.debug("refreshPbExpData: requestVersion="+e),this.expDataFetcher.fetch([],e).then(e=>(o.DefaultLogger.debug("handleExpResponse: ",e),!!e&&(this.isNeedToHandleResponse(e)?(o.DefaultLogger.debug("handleExpResponse is need to handle"),this.handleResponseDataVersion(e),this.handleResponseExpData(e),this.handleResponseControlInfo(e),void t(!0)):(o.DefaultLogger.debug("handleExpResponse return by is not need"),!0))),e=>{o.DefaultLogger.error(e),t(!1)})})}))}handleResponseDataVersion(e){o.DefaultLogger.debug("handleResponseDataVersion，exp ignore")}isNeedToHandleResponse(e,t){return!!this.expDataFetcher.isExpResponseSuccess(e)||(o.DefaultLogger.debug("exp isNeedToHandleResponse return false is not responseSuccess"),!1)}}},"../abc_web_core/lib/experiment/exp_fetcher.js":function(e,t,r){"use strict";r.r(t),r.d(t,"ExpDataFetcher",(function(){return _}));var n,o=r("../abc_web_core/lib/logger.js"),i=r("../abc_web_core/lib/constant.js"),a=r("../abc_web_core/lib/utils.js"),s=r("../abc_web_core/lib/experiment/exp_info.js"),E=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{E(n.next(e))}catch(e){i(e)}}function s(e){try{E(n.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}E((n=n.apply(e,t||[])).next())}))};!function(e){e[e.RET_CODE_UNKNOWN=0]="RET_CODE_UNKNOWN",e[e.RET_CODE_SUCCESS=100]="RET_CODE_SUCCESS",e[e.RET_CODE_NO_PERMISSION=101]="RET_CODE_NO_PERMISSION",e[e.RET_CODE_TRAFFIC_LIMIT=102]="RET_CODE_TRAFFIC_LIMIT",e[e.RET_CODE_APP_ID_ERR=103]="RET_CODE_APP_ID_ERR",e[e.RET_CODE_SERVER_ERR=104]="RET_CODE_SERVER_ERR",e[e.RET_CODE_GUID_ERR=105]="RET_CODE_GUID_ERR"}(n||(n={}));class _{constructor(e){this.config=e,this.identifier=`_${this.config.gameId}_`}fetch(e,t){return E(this,void 0,void 0,(function*(){const r=this.getRequestDomain()+"/tab/get_experiments",n={exp_group_keys:e||[],module_codes:[],scene_ids:[]},s={app_id:this.config.gameId,guid:this.config.unitId||this.getDeviceId(this.identifier),profiles:this.generateAttributes(),time_version:t?Math.max(t,0):0,filter_options:n},E=this.config.requestTimeout||i.DefaultHttpTimeout;o.DefaultLogger.debug(`fetch net data request ${r} reqExpData =`,s);const _=Object(a.generateSignHeader)(this.config.apiKey);return this.sendStringRequestWithStringResponse(r,s,_,E)}))}parseResponseExpControlData(e){if(!e)return o.DefaultLogger.debug("parseResponseExpControlData expResponse is null"),null;const t=e.control_data;if(!t)return o.DefaultLogger.debug("parseResponseExpControlData control data is null"),null;const r={rollInterval:t.refresh_duration,enableReport:t.enable_report,reportInterval:t.report_time_interval};return o.DefaultLogger.debug(`expResponse parseResponseExpControlData: rollInterval=${r.rollInterval}s\n    , enableReport=${r.enableReport}, reportInterval=${r.reportInterval}`),r}parseResponseExpData(e){const t=new Map;if(!e)return o.DefaultLogger.debug("parseResponseExpData responseExpData is null"),t;const r=e.exp_data;return r?(o.DefaultLogger.debug("parseResponseExpData before: size: "+Object.keys(r).length),Object.keys(r).forEach(e=>{const n=r[e];if(n){const r={expName:n.exp_group_key,assignment:n.exp_key,expGrayId:n.exp_id,layerName:n.module_code,expParams:n.params},o=Object.assign(new s.ExperimentInfo,r);t.set(e,o)}}),o.DefaultLogger.debug("parseResponseExpData filter after: size: "+t.size),o.DefaultLogger.debug(t),t):(o.DefaultLogger.debug("parseResponseExpData expResponseInfos is null"),t)}parseResponseDataUpdateType(e){if(!e)return null;const t=e.data_update_type;return o.DefaultLogger.debug("parseResponseDataUpdateType: ServerResponseDataUpdateType = "+t),t}isExpResponseSuccess(e){if(!e)return!1;const t=e.ret_code;return o.DefaultLogger.debug(`isExpResponseSuccess：\n  ServerResponseStatus = ${t} === ${n.RET_CODE_SUCCESS}`),t===n.RET_CODE_SUCCESS}generateAttributes(){var e;const t=(null===(e=this.config)||void 0===e?void 0:e.attributes)||{},r={};return Object.entries(t).forEach(([e,t])=>{r[e]={user_attrs:t}}),r}getRequestDomain(){var e;const t=null===(e=this.config)||void 0===e?void 0:e.environment;if(!t)return i.FETCH_URL_RELEASE;switch(t){case 1:return i.FETCH_URL_DEVELOP;default:return i.FETCH_URL_RELEASE}}}},"../abc_web_core/lib/experiment/exp_info.js":function(e,t,r){"use strict";r.r(t),r.d(t,"ExperimentInfo",(function(){return i}));var n=r("../abc_web_core/lib/featureflag/feature_flag_constants.js"),o=r("../abc_web_core/lib/logger.js");class i{getBoolValue(e,t){return this.expParams&&this.expParams[e]?(o.DefaultLogger.debug(this.expParams[e]),n.DEFAULT_BOOLEAN_TRUTHY_VALUES.indexOf(this.expParams[e].toLowerCase())>=0):t}getStringValue(e,t){return this.expParams&&this.expParams[e]?this.expParams[e]:t}getNumberValue(e,t){if(!this.expParams||!this.expParams[e])return t;const r=Number(this.expParams[e]);return isNaN(r)?t:r}}},"../abc_web_core/lib/experiment/exp_model.js":function(e,t){},"../abc_web_core/lib/experiment/exp_report_fetcher.js":function(e,t,r){"use strict";r.r(t),r.d(t,"ExpReportFetcher",(function(){return s}));var n=r("../abc_web_core/lib/logger.js"),o=r("../abc_web_core/lib/constant.js"),i=r("../abc_web_core/lib/utils.js"),a=r("../abc_web_core/lib/core/proto/type.js");class s{constructor(e,t,r){this.config=e,this.sdkVersion=t,this.sdkPlatform=r,this.identifier=`_${this.config.gameId}_`}report(e,t){var r;const s=this.getExposureDomain()+""+o.FETCH_EXPOSURE_URL_PATH;n.DefaultLogger.debug("report exp net data request, isFromSDK: "+t,s);const E={version:this.sdkVersion||o.EVENT_SDK_VERSION_DEFAULT_VAL,platform:this.sdkPlatform||o.EVENT_SDK_PLATFORM_DEFAULT_VAL},_={device_id:this.getDeviceId(this.identifier),user_id:this.config.unitId||"",extra_data:{}},u={group_id:e.expGrayId,layer_key:e.layerName,exposure_type:t?a.ExposureType.EXPOSURE_TYPE_AUTOMATIC:a.ExposureType.EXPOSURE_TYPE_MANUAL,user:_,extra_data:{}},c={event_code:"$mg_exp",event_time:Math.floor((new Date).getTime()/1e3),event_type:a.EventType.EVENT_TYPE_EXPERIMENT,event_status:1===(null===(r=this.config)||void 0===r?void 0:r.environment)?a.EventStatus.EVENT_STATUS_DEBUG:a.EventStatus.EVENT_STATUS_FORMAL,app_id:this.config.gameId||"",exposures:[u],sdk_info:E,properties:{os_type:"",os_version:"",app_version:"",app_platform:"",device_model:"",manufacturer:"",system_language:"",network_type:"",ip:"",scene:"",screen_width:0,screen_height:0},user:_,event_value:{}},f=this.config.requestTimeout||o.DefaultHttpTimeout,l=Object(i.generateSignHeader)(this.config.apiKey);return this.sendStringRequestWithStringResponse(s,c,l,f)}getExposureDomain(){var e,t;const r=null===(e=this.config)||void 0===e?void 0:e.environment;let n=o.FETCH_URL_EVENT_DOMAIN_RELEASE;return 1===r&&(n=o.FETCH_URL_EVENT_DOMAIN_DEVELOP),(null===(t=this.config)||void 0===t?void 0:t.serverUrl)&&(n=this.config.serverUrl),n}}},"../abc_web_core/lib/experiment/exp_reporter.js":function(e,t,r){"use strict";r.r(t),r.d(t,"ExpDataReporter",(function(){return E}));var n=r("../abc_web_core/lib/constant.js"),o=r("../abc_web_core/lib/logger.js"),i=r("../abc_web_core/lib/core/proto/type.js"),a=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{E(n.next(e))}catch(e){i(e)}}function s(e){try{E(n.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}E((n=n.apply(e,t||[])).next())}))};const s=o.DefaultLogger;class E{constructor(e,t,r){this.appId=e.gameId,this.unitId=e.unitId||"",this.sdkVersion=t,this.sdkPlatform=r,this.config=e,this.reportFetcher=this.initExpReportFetcher(e,t,r)}reportExposeFromSDK(e,t){return a(this,void 0,void 0,(function*(){if(this.isNeedReportExpose(e,t)){const t=yield this.reportEventByDomain(e,!0);return s.debug("expReporter reportExposeFromSDK: "+t),t}return!1}))}reportExposeFromUser(e,t){return a(this,void 0,void 0,(function*(){if(this.isNeedReportExpose(e,t)){const t=yield this.reportEventByDomain(e,!1);return s.debug("expReporter reportExposeFromUser: "+t),t}return!1}))}reportEventByDomain(e,t){return new Promise(r=>{this.reportFetcher.report(e,t).then(e=>{o.DefaultLogger.debug(e,`reportEventByDomain: serverReportCode = ${e.code},\n        serverReportMsg = ${e.message}`),r(e.code===i.EventServerCode[""+i.EventServerCode.EVENT_SERVER_CODE_SUCCESS])})})}isNeedReportExpose(e,t){var r;return e?0===(null===(r=e.expName)||void 0===r?void 0:r.length)||e.assignment===n.DEFAULT_ASSIGNMENT?(s.debug("isNeedReportExpose false, expGroup empty or assignment default, ignore"),!1):!!this.isNeedToReportByReportInterval(e,t)||(s.debug("isNeedReportExpose false, report interval not match, ignore"),!1):(s.debug("isNeedReportExpose false, expInfo null, ignore"),!1)}isNeedToReportByReportInterval(e,t){if(t<=0)return e.lastReportTime=Date.parse((new Date).toString()),!0;t*=1e3;return!(Date.parse((new Date).toString())-e.lastReportTime<t)&&(e.lastReportTime=Date.parse((new Date).toString()),!0)}}},"../abc_web_core/lib/experiment/exp_storage.js":function(e,t,r){"use strict";r.r(t),r.d(t,"ExpDataStorage",(function(){return _}));var n=r("../abc_web_core/lib/utils.js"),o=r("../abc_web_core/lib/logger.js"),i=r("../abc_web_core/lib/constant.js"),a=r("../abc_web_core/lib/experiment/exp_info.js"),s=r("../abc_web_core/lib/core/proto/type.js"),E=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{E(n.next(e))}catch(e){i(e)}}function s(e){try{E(n.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}E((n=n.apply(e,t||[])).next())}))};class _{constructor(e){this.config=e,this.identifier=`${this.config.gameId}_${this.config.unitId}`,this.expInfoMap=new Map,this.expKeyLayerMap=new Map,this.expControlInfo=this.createDefaultExpControlInfo()}initExpStorageData(){return E(this,void 0,void 0,(function*(){o.DefaultLogger.debug("expStorageData expStorage start load local storage all exp data");const e=yield this.initExpData(),t=yield this.initExpControlInfo();return o.DefaultLogger.debug(`expDataStorage: expData = ${e}, controlData = ${t}`),e&&t}))}initExpData(){return E(this,void 0,void 0,(function*(){try{const e=yield this.getStorageAllKey();e&&Object.keys(e).forEach(t=>{const r=e[t];r.startsWith(`_${this.identifier}_${i.EXP_DATA_KEY}_`)&&this.getStorageString(r).then(e=>{if(e){const t=JSON.parse(e),r=Object.assign(new a.ExperimentInfo,t);this.putMemoryExpData(t.layerName,r)}})})}catch(e){return o.DefaultLogger.error(e),!1}return!0}))}initExpControlInfo(){return E(this,void 0,void 0,(function*(){const e=yield this.getStorageString(`_${this.identifier}_${i.EXP_CONTROL_DATA_KEY}_`);if(o.DefaultLogger.debug(`expDataStorage init exp controlInfo: _${this.identifier}_${i.EXP_CONTROL_DATA_KEY}_ : ${e}`),e)try{const t=JSON.parse(e);this.putMemoryControlInfo(t)}catch(e){return o.DefaultLogger.debug(e),!1}return!0}))}getMemoryExpDataByExpGroupKey(e){if(void 0===this.expKeyLayerMap||void 0===this.expInfoMap)return;const t=this.expKeyLayerMap.get(e);return 0!==(null==t?void 0:t.length)?this.expInfoMap.get(t):void 0}getMemoryExpDataByLayerName(e){if(void 0!==this.expInfoMap)return this.expInfoMap.get(e)}handleResponseControlInfo(e){e&&this.putControlInfo(e)}handleResponseExpData(e,t){const r=e.size;if(o.DefaultLogger.debug("handleResponseExpData: responseExpDataSize after = "+r),e&&this.expInfoMap&&this.expKeyLayerMap)if(o.DefaultLogger.debug("handleResponseExpData: dataUpdateType = "+t),t===s.DataUpdateType.DATA_UPDATE_TYPE_ALL)o.DefaultLogger.debug("handleResponseExpData: handleResponseAllData"),this.handleResponseAllData(e);else if(t===s.DataUpdateType.DATA_UPDATE_TYPE_DIFF)o.DefaultLogger.debug("handleResponseExpData: handleResponseDiffData"),this.handleResponseDiffData(e);else{if(t===s.DataUpdateType.DATA_UPDATE_TYPE_NO_NEED)return;this.handleResponseAllData(e)}}getExpInfoMap(){return this.expInfoMap}getRollInterval(){var e;return null!==(e=this.expControlInfo.rollInterval)&&void 0!==e?e:i.DEFAULT_ROLL_INTERVAL}getReportInterval(){var e;return null!==(e=this.expControlInfo.reportInterval)&&void 0!==e?e:i.MIN_REPORT_INTERVAL}isEnableReport(){var e;return null!==(e=this.expControlInfo.enableReport)&&void 0!==e&&e}handleResponseAllData(e){this.compareDiffForPutData(this.expInfoMap,e),this.compareDiffForRemoveData(this.expInfoMap,e)}handleResponseDiffData(e){this.compareDiffForPutData(this.expInfoMap,e)}compareDiffForPutData(e,t){e&&t&&t.forEach((t,r)=>{if(!t||!r)return;const o=e.get(r);o&&Object(n.compareObject)(o,t)||this.putExpData(r,t)})}compareDiffForRemoveData(e,t){e&&t&&e.forEach((e,r)=>{r&&!t.has(r)&&this.removeExpData(r)})}createDefaultExpControlInfo(){return{enableReport:!1,reportInterval:60,reportType:"beacon",rollInterval:i.DEFAULT_ROLL_INTERVAL}}putControlInfo(e){e&&(this.putMemoryControlInfo(e),this.putStorageControlInfo(e).then())}putExpData(e,t){e&&t&&(this.putMemoryExpData(e,t),this.putStorageExpData(e,t).then())}removeExpData(e){e&&(this.removeMemoryExpData(e),this.removeStorageExpData(e).then())}putStorageExpData(e,t){return E(this,void 0,void 0,(function*(){try{const r=JSON.stringify(t);yield this.putStorageString(`_${this.identifier}_${i.EXP_DATA_KEY}_${e}`,r)}catch(e){o.DefaultLogger.error(e)}}))}removeStorageExpData(e){return E(this,void 0,void 0,(function*(){e&&(yield this.removeStorageString(`_${this.identifier}_${i.EXP_DATA_KEY}_${e}`))}))}putStorageControlInfo(e){return E(this,void 0,void 0,(function*(){try{const t=JSON.stringify(e);yield this.putStorageString(`_${this.identifier}_${i.EXP_CONTROL_DATA_KEY}_`,t)}catch(e){o.DefaultLogger.error(e)}}))}putMemoryExpData(e,t){this.expInfoMap.set(e,t),t.expName&&this.expKeyLayerMap.set(t.expName,e)}removeMemoryExpData(e){return!!e&&(this.expInfoMap?this.expInfoMap.delete(e):(o.DefaultLogger.info("removeMemoryExpData --- expInfoMap null"),!1))}putMemoryControlInfo(e){this.expControlInfo.enableReport=e.enableReport,this.expControlInfo.rollInterval=e.rollInterval,this.expControlInfo.reportInterval=e.reportInterval,this.expControlInfo.reportType=e.reportType}}},"../abc_web_core/lib/featureflag/feature_flag_api.js":function(e,t){},"../abc_web_core/lib/featureflag/feature_flag_component.js":function(e,t,r){"use strict";r.r(t),r.d(t,"FeatureFlagComponent",(function(){return E}));var n=r("../abc_web_core/lib/sdk_event.js"),o=r("../abc_web_core/lib/logger.js"),i=r("../abc_web_core/lib/featureflag/feature_flag_constants.js"),a=r("../abc_web_core/lib/constant.js"),s=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{E(n.next(e))}catch(e){i(e)}}function s(e){try{E(n.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}E((n=n.apply(e,t||[])).next())}))};class E{constructor(e){this.eventHandler=new n.SDKEventHandler,this.config=e,this.initComponentData()}initFeatureFlagData(){return s(this,void 0,void 0,(function*(){const e=yield this.initFeatureFlagStorageData(),t=yield this.initFeatureFlagNetworkData();return o.DefaultLogger.debug(`featureFlagComponent initFeatureFlagData: storageData = ${e},\n    networkData = ${t}`),this.initFeatureFlagRefreshTimer(),e&&t}))}getConfig(e){const t=this.featureFlagStorage.getFeatureFlagInfoByKey(e),{enableAutoExposure:r}=this.config,n=void 0===r?!!r:r;return t&&n&&this.reportConfigFromSDK(n,t).then(e=>{o.DefaultLogger.debug(`featureFlagComponent: getConfigInfoByKey isAutoReport = ${r},\n        isNeedReport = ${r}, reportResult = ${e}`)}),t}getConfigByKeys(e){const t={};for(const r of e){const e=this.featureFlagStorage.getFeatureFlagInfoByKey(r);o.DefaultLogger.debug("featureFlagComponent: getConfigByKeys configKey = "),t[r]=e?e.featureFlagValue:void 0}return t}refreshFeatureFlag(){return s(this,void 0,void 0,(function*(){return this.refreshFeatureFlagData(i.FEATURE_FLAG_FETCH_DATA_DEFAULT_VERSION)}))}logFeatureFlagExposure(e){return s(this,void 0,void 0,(function*(){const t=this.getConfig(e);return this.reportConfigFromUser(t)}))}clearFeatureFlagSDK(){this.timeInterval&&(clearInterval(this.timeInterval),this.timeInterval=null)}initComponentData(){this.featureFlagRequestVersion=i.FEATURE_FLAG_FETCH_DATA_DEFAULT_VERSION,this.initFeatureFlagFetcher(),this.initFeatureFlagReporter(),this.initFeatureFlagStorage()}initFeatureFlagRefreshTimer(){const{enableAutoPoll:e}=this.config;(e||void 0===typeof e)&&(o.DefaultLogger.debug("start featureFlag refresh time enableAutomaticPoll\n       = "+this.config.enableAutoPoll),this.timeInterval=setInterval(()=>{const e=this.getRollInterval();o.DefaultLogger.debug(`config data refresh time roll up: ${e}s, min 600s`),this.refreshFeatureFlagData(this.featureFlagRequestVersion).then()},1e3*this.getRollInterval()))}initFeatureFlagStorageData(){return s(this,void 0,void 0,(function*(){return this.featureFlagStorage.initFeatureFlagStorageData()}))}initFeatureFlagNetworkData(){return s(this,void 0,void 0,(function*(){try{return yield this.refreshFeatureFlagData(this.featureFlagRequestVersion)}catch(e){return o.DefaultLogger.error(e),!1}}))}refreshFeatureFlagData(e){return s(this,void 0,void 0,(function*(){return new Promise(t=>{const r=this.isDefaultRequestVersion(e);o.DefaultLogger.debug("refreshFeatureFlagData isFeatureFlagDefaultVersion = "+r),this.featureFlagFetcher.fetch([],e).then(e=>{o.DefaultLogger.debug("refreshFeatureFlagData response = ",e),this.isNeedToHandleResponse(r,e)?(o.DefaultLogger.debug("handleFeatureFlagResponse is need to handle"),this.handleResponseFeatureFlagVersion(e),this.handleResponseFeatureFlagData(r,e),this.handleResponseFeatureFlagControlData(e),t(!0)):o.DefaultLogger.debug("handleFeatureFlagResponse return by is not need")},e=>{o.DefaultLogger.info(e),t(!1)})})}))}isNeedToHandleResponse(e,t){if(!this.featureFlagFetcher.isFeatureFlagResponseSuccess(t))return o.DefaultLogger.debug("feature flag isNeedToHandleResponse return false is not responseSuccess"),!1;if(e)return o.DefaultLogger.debug("feature flag isNeedToHandleResponse return true is default request feature flag version"),!0;const r=this.featureFlagStorage.getMemoryFeatureFlagVersion(),n=this.featureFlagFetcher.parseResponseFeatureFlagVersion(t);return r>=n?(o.DefaultLogger.debug(`isNeedToHandleResponse return false by\n        responseConfigVersion not upgrade: memoryConfigVersion = ${r},\n        responseConfigVersion = ${n}`),!1):(o.DefaultLogger.debug(`isNeedToHandleResponse return true by\n      responseConfigVersion should upgrade: memoryConfigVersion = ${r},\n      responseConfigVersion = ${n}`),!0)}isDefaultRequestVersion(e){return i.FEATURE_FLAG_FETCH_DATA_DEFAULT_VERSION===e}handleResponseFeatureFlagVersion(e){const t=this.featureFlagFetcher.parseResponseFeatureFlagVersion(e);o.DefaultLogger.debug("handleResponseFeatureFlagVersion responseFeatureFlagVersion = "+t),this.updateRequestFeatureFlagVersion(t),this.featureFlagStorage.handleResponseFeatureFlagVersion(t)}updateRequestFeatureFlagVersion(e){this.featureFlagRequestVersion=e,o.DefaultLogger.debug("updateRequestVersion featureFlagRequestVersion = "+this.featureFlagRequestVersion)}handleResponseFeatureFlagData(e,t){const r=this.featureFlagFetcher.parseResponseFeatureFlagData(t);o.DefaultLogger.debug("handleResponseConfigData after size = "+r.size),this.featureFlagStorage.handleResponseFeatureFlagData(e,r)}handleResponseFeatureFlagControlData(e){const t=this.featureFlagFetcher.parseResponseFeatureFlagControlData(e);this.featureFlagStorage.handleResponseFeatureFlagControlInfo(t)}getReportInterval(){const e=this.featureFlagStorage.getReportInterval(),t=Math.max(e,a.MIN_REPORT_INTERVAL);return o.DefaultLogger.debug("featureFlagComponent reportInterval = "+t),t}getRollInterval(){const e=this.featureFlagStorage.getRollInterval();return o.DefaultLogger.debug("featureFlagComponent rollInterval = "+e),Math.max(e,a.DEFAULT_ROLL_INTERVAL)}isEnableReport(){const e=this.featureFlagStorage.isEnableReport();return o.DefaultLogger.debug("featureFlagComponent isEnableReport = "+e),e}reportConfigFromSDK(e,t){return s(this,void 0,void 0,(function*(){return!(!e||!this.isEnableReport())&&(yield this.featureFlagReporter.reportFeatureFlagFromSDK(t,this.getReportInterval()))}))}reportConfigFromUser(e){return s(this,void 0,void 0,(function*(){return!!this.isEnableReport()&&(yield this.featureFlagReporter.reportFeatureFlagFromUser(e,this.getReportInterval()))}))}}},"../abc_web_core/lib/featureflag/feature_flag_constants.js":function(e,t,r){"use strict";r.r(t),r.d(t,"FEATURE_FLAG_CONTROL_DATA_KEY",(function(){return n})),r.d(t,"FEATURE_FLAG_DATA_KEY",(function(){return o})),r.d(t,"FEATURE_FLAG_VERSION_DATA_KEY",(function(){return i})),r.d(t,"FEATURE_FLAG_FETCH_URL_RELEASE",(function(){return a})),r.d(t,"FEATURE_FLAG_FETCH_URL_DEVELOP",(function(){return s})),r.d(t,"FEATURE_FLAG_FETCH_DATA_DEFAULT_VERSION",(function(){return E})),r.d(t,"DEFAULT_BOOLEAN_TRUTHY_VALUES",(function(){return _})),r.d(t,"DEFAULT_BOOLEAN_FALSE_VALUES",(function(){return u}));const n="feature_flag_control_data_key",o="feature_flag_data_key",i="feature_flag_version_data_key",a="https://mobile.abetterchoice.cn",s="https://abc-minigame-test-openapi.woa.com",E=0,_=["1","true","t","yes","y","on"],u=["0","false","f","no","n","off"]},"../abc_web_core/lib/featureflag/feature_flag_fetcher.js":function(e,t,r){"use strict";r.r(t),r.d(t,"FeatureFlagDataFetcher",(function(){return _}));var n=r("../abc_web_core/lib/logger.js"),o=r("../abc_web_core/lib/constant.js"),i=r("../abc_web_core/lib/featureflag/feature_flag_constants.js"),a=r("../abc_web_core/lib/featureflag/feature_flag_parser.js"),s=r("../abc_web_core/lib/utils.js"),E=r("../abc_web_core/lib/core/proto/type.js");class _{constructor(e,t=""){this.config=e,this.identifier=`_${this.config.gameId}_`}fetch(e,t){const r=this.getFeatureFlagRequestDomain()+"/tab/get_feature_flags",i={project_id:this.config.gameId,unit_id:this.config.unitId||this.getDeviceId(this.identifier),feature_names:e,profiles:this.generateAttributes(),scene_ids:[]},a=this.config.requestTimeout||o.DefaultHttpTimeout;n.DefaultLogger.debug(`fetch featureFlags net data request: featureFlagKeys = ${e},\n    requestVersion = ${t}`,r,i);const E=Object(s.generateSignHeader)(this.config.apiKey);return this.sendStringRequestWithStringResponse(r,i,E,a)}parseResponseFeatureFlagVersion(e){return a.FeatureFlagDataParser.convertFeatureFlagVersion(e)}parseResponseFeatureFlagData(e){return a.FeatureFlagDataParser.convertFeatureFlagDataToMap(e)}parseResponseFeatureFlagControlData(e){return a.FeatureFlagDataParser.convertFeatureFlagControlData(e)}isFeatureFlagResponseSuccess(e){return!!e&&(n.DefaultLogger.debug(`isFeatureFlagResponseSuccess： ServerResponseStatus = ${e.ret_code},ServerResponseMsg = ${e.msg}`),e.ret_code===E.FeatureFlagResponseStatusRetCode.RET_CODE_SUCCESS)}generateAttributes(){var e;const t=(null===(e=this.config)||void 0===e?void 0:e.attributes)||{},r={};return Object.entries(t).forEach(([e,t])=>{r[e]={user_attrs:t}}),r}getFeatureFlagRequestDomain(){var e;const t=null===(e=this.config)||void 0===e?void 0:e.environment;if(!t)return i.FEATURE_FLAG_FETCH_URL_RELEASE;switch(t){case 1:return i.FEATURE_FLAG_FETCH_URL_DEVELOP;default:return i.FEATURE_FLAG_FETCH_URL_RELEASE}}}},"../abc_web_core/lib/featureflag/feature_flag_info.js":function(e,t,r){"use strict";r.r(t),r.d(t,"ConfigInfo",(function(){return o}));var n=r("../abc_web_core/lib/featureflag/feature_flag_constants.js");class o{getBoolValue(e){return this.featureFlagValue?n.DEFAULT_BOOLEAN_TRUTHY_VALUES.indexOf(this.featureFlagValue.toLowerCase())>=0:e}getStringValue(e){return this.featureFlagValue?this.featureFlagValue:e}getNumberValue(e){if(!this.featureFlagValue)return e;const t=Number(this.featureFlagValue);return isNaN(t)?e:t}}},"../abc_web_core/lib/featureflag/feature_flag_model.js":function(e,t){},"../abc_web_core/lib/featureflag/feature_flag_parser.js":function(e,t,r){"use strict";r.r(t),r.d(t,"FeatureFlagDataParser",(function(){return a}));var n=r("../abc_web_core/lib/logger.js"),o=r("../abc_web_core/lib/featureflag/feature_flag_constants.js"),i=r("../abc_web_core/lib/featureflag/feature_flag_info.js");class a{static convertFeatureFlagVersion(e){return e&&void 0!==e.version?e.version:o.FEATURE_FLAG_FETCH_DATA_DEFAULT_VERSION}static convertFeatureFlagDataToMap(e){const t=new Map;if(!e)return n.DefaultLogger.debug("convertFeatureFlagDataToMap is null"),t;const r=e.data;return r?(Object.keys(r).forEach(e=>{const o=r[e];if(o&&o.value){const r=new i.ConfigInfo;r.featureFlagExpData=o.relative_experiment,r.featureFlagKey=e,r.featureFlagValue=o.value,t.set(e,r)}else n.DefaultLogger.debug(`convertFeatureFlagDataToMap: featureFlagKey=${e} is empty value and ignore`)}),t):(n.DefaultLogger.debug("convertFeatureFlagDataToMap data is null"),t)}static convertFeatureFlagControlData(e){if(!e)return n.DefaultLogger.debug("convertFeatureFlagControlData is null"),null;if(!e.contro_data)return n.DefaultLogger.debug("convertFeatureFlagControlData control_data is null"),null;const t=e.control_data,r={rollInterval:t.refresh_duration,enableReport:t.enable_report,reportInterval:t.report_infra};return n.DefaultLogger.debug(`configResponse convertFeatureFlagControlData: rollInterval=${r.rollInterval},\n      enableReport=${r.enableReport},\n      reportInterval=${r.reportInterval}`),r}}},"../abc_web_core/lib/featureflag/feature_flag_reporter.js":function(e,t,r){"use strict";r.r(t),r.d(t,"FeatureFlagDataReport",(function(){return a}));var n=r("../abc_web_core/lib/logger.js"),o=r("../abc_web_core/lib/constant.js"),i=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{E(n.next(e))}catch(e){i(e)}}function s(e){try{E(n.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}E((n=n.apply(e,t||[])).next())}))};class a{constructor(e,t,r=""){this.projectId=e,this.unitId=t,this.sdkVersion=r}reportFeatureFlagFromSDK(e,t){return i(this,void 0,void 0,(function*(){if(this.isNeedToReportFeatureFlagExpose(e,t)){const t=yield this.reportFeatureFlagExposure(e,!0);return n.DefaultLogger.debug("reportFeatureFlagFromSDK: sdkReportResult = "+t),t}return!1}))}reportFeatureFlagFromUser(e,t){return i(this,void 0,void 0,(function*(){if(this.isNeedToReportFeatureFlagExpose(e,t)){const t=yield this.reportFeatureFlagExposure(e,!1);return n.DefaultLogger.debug("reportFeatureFlagFromUser: userReportResult = "+t),t}return!1}))}isNeedToReportFeatureFlagExpose(e,t){return this.unitId&&0!==this.unitId.length&&e?0===e.featureFlagKey.length||0===e.featureFlagValue.length?(n.DefaultLogger.debug("isNeedToReportFeatureFlagExpose false, featureFlagKey or featureFlagValue is empty, ignore report"),!1):!!this.isNeedToReportByReportInterval(e,t)||(n.DefaultLogger.debug("isNeedToReportFeatureFlagExpose false, featureFlag report interval not match, ignore report"),!1):(n.DefaultLogger.debug(`isNeedToReportFeatureFlagExpose false, unitId or featureFlagInfo is null,\n      ignore report: ${this.unitId}: ${e}`),!1)}isNeedToReportByReportInterval(e,t){if(t<=0)return e.lastReportTime=Date.parse((new Date).toString()),!0;t*=1e3;return!(Date.parse((new Date).toString())-e.lastReportTime<t)&&(e.lastReportTime=Date.parse((new Date).toString()),!0)}reportFeatureFlagExposure(e,t){return new Promise(r=>{const i={};return i[o.COMMON_EVENT_PARAM_KEY_TAB_SDK_VERSION]=this.sdkVersion,i[o.COMMON_EVENT_PARAM_KEY_APP_ID]=this.projectId,i[o.COMMON_EVENT_PARAM_KEY_USER_ID]=this.unitId,i[o.EXPOSE_EVENT_PARAM_KEY_REPORT_METHOD]=t?o.EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_SDK:o.EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_USER,i.config_key=e.featureFlagKey,this.reportExposureEvent("abc_feature_flag_exposure",i).then(()=>{r(!1)}).catch(e=>{n.DefaultLogger.debug("reportFeatureFlagExposure error: "+e.message),r(!1)})})}}},"../abc_web_core/lib/featureflag/feature_flag_storage.js":function(e,t,r){"use strict";r.r(t),r.d(t,"FeatureFlagDataStorage",(function(){return s}));var n=r("../abc_web_core/lib/logger.js"),o=r("../abc_web_core/lib/featureflag/feature_flag_constants.js"),i=r("../abc_web_core/lib/featureflag/feature_flag_info.js"),a=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{E(n.next(e))}catch(e){i(e)}}function s(e){try{E(n.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}E((n=n.apply(e,t||[])).next())}))};class s{constructor(e){this.config=e,this.featureFlagIdentifier=`${e.gameId}_${e.unitId}`,this.featureFlagInfoMap=new Map,this.featureFlagVersion=o.FEATURE_FLAG_FETCH_DATA_DEFAULT_VERSION,this.featureFlagControlInfo=this.createDefaultFeatureFlagControlInfo(),this.defaultConfigInitLoader=[this.initFeatureFlagData,this.initFeatureFlagControlInfo]}initFeatureFlagStorageData(){return a(this,void 0,void 0,(function*(){n.DefaultLogger.debug("start load local storage all feature flag data");const e=yield this.initFeatureFlagVersion(),t=yield this.initFeatureFlagData(),r=yield this.initFeatureFlagControlInfo();return n.DefaultLogger.debug(`ConfigDataStorage initConfigStorageData:\n    version = ${e}, toggleData = ${t}, controlData = ${r}`),e&&t&&r}))}handleResponseFeatureFlagVersion(e){this.putMemoryFeatureFlagVersion(e),this.putStorageFeatureFlagVersion(e)}handleResponseFeatureFlagData(e,t){if(0===t.size)return void n.DefaultLogger.debug("handleResponseFeatureFlagData size is empty and ignore");const r=this.getMemoryFeatureFlagDataMap();n.DefaultLogger.debug("handleResponseConfigData old size "+r.size),this.compareDiffForPutConfigData(r,t),e&&this.compareDiffForRemoveConfigData(r,t)}handleResponseFeatureFlagControlInfo(e){e&&this.putFeatureFlagControlInfo(e)}getFeatureFlagInfoByKey(e){return this.getMemoryFeatureFlagDataMap().get(e)}getMemoryFeatureFlagDataMap(){return this.featureFlagInfoMap}getMemoryFeatureFlagVersion(){return this.featureFlagVersion}getMemoryFeatureFlagControlData(){return this.featureFlagControlInfo}getReportInterval(){return this.featureFlagControlInfo.reportInterval}getRollInterval(){return this.featureFlagControlInfo.rollInterval}isEnableReport(){return this.featureFlagControlInfo.enableReport}putStorageFeatureFlagInfo(e,t){if(e&&t)return this.putStorageString(`_${this.featureFlagIdentifier}_${o.FEATURE_FLAG_DATA_KEY}_${e}`,JSON.stringify(t))}putStorageFeatureFlagControlInfo(e){if(e)return this.putStorageString(`_${this.featureFlagIdentifier}_${o.FEATURE_FLAG_CONTROL_DATA_KEY}_`,JSON.stringify(e))}removeStorageFeatureFlagInfo(e){if(e)return this.removeStorageString(`${this.featureFlagIdentifier}_${o.FEATURE_FLAG_DATA_KEY}_${e}`)}removeMemoryFeatureFlagInfo(e){if(!e)return;this.getMemoryFeatureFlagDataMap().delete(e)}putFeatureFlagInfo(e,t){this.putMemoryFeatureFlagInfo(e,t),this.putStorageFeatureFlagInfo(e,t)}removeFeatureFlagData(e){this.removeMemoryFeatureFlagInfo(e),this.removeStorageFeatureFlagInfo(e)}putFeatureFlagControlInfo(e){this.putMemoryFeatureFlagControlInfo(e),this.putStorageFeatureFlagControlInfo(e)}compareDiffForPutConfigData(e,t){e&&t?(n.DefaultLogger.debug(`compareDiffForPutConfigData: memoryOldDataSize = ${e.size}\n      : responseDataSize = ${t.size}`),t.forEach((t,r)=>{const n=e.get(r);JSON.stringify(t)!==JSON.stringify(n)&&this.putFeatureFlagInfo(r,t)})):n.DefaultLogger.debug(`${e}_${t}`)}compareDiffForRemoveConfigData(e,t){e&&t&&e.forEach((e,r)=>{t.has(r)||this.removeFeatureFlagData(r)})}putStorageFeatureFlagVersion(e){if(e)return this.putStorageString(`_${this.featureFlagIdentifier}_${o.FEATURE_FLAG_VERSION_DATA_KEY}_`,String(e))}putMemoryFeatureFlagInfo(e,t){this.featureFlagInfoMap.set(e,t)}putMemoryFeatureFlagControlInfo(e){this.featureFlagControlInfo.enableReport=e.enableReport,this.featureFlagControlInfo.rollInterval=e.rollInterval,this.featureFlagControlInfo.reportInterval=e.reportInterval,this.featureFlagControlInfo.reportType=e.reportType}putMemoryFeatureFlagVersion(e){this.featureFlagVersion=e}initFeatureFlagData(){return a(this,void 0,void 0,(function*(){try{const e=yield this.getStorageAllKey();if(e){const t=`_${this.featureFlagIdentifier}_${o.FEATURE_FLAG_DATA_KEY}_`.length;for(const r of e)if(r.startsWith(`_${this.featureFlagIdentifier}_${o.FEATURE_FLAG_DATA_KEY}_`)){const e=yield this.getStorageString(r);if(e){const n=JSON.parse(e),o=Object.assign(new i.ConfigInfo,n),a=r.substr(t);this.putMemoryFeatureFlagInfo(a,o)}}}}catch(e){return n.DefaultLogger.error(e),!1}return!0}))}initFeatureFlagControlInfo(){return a(this,void 0,void 0,(function*(){try{const e=yield this.getStorageString(`_${this.featureFlagIdentifier}_${o.FEATURE_FLAG_CONTROL_DATA_KEY}_`);if(e){const t=JSON.parse(e);this.putMemoryFeatureFlagControlInfo(t),n.DefaultLogger.debug(this.featureFlagControlInfo)}}catch(e){return n.DefaultLogger.error(e),!1}return!0}))}initFeatureFlagVersion(){return a(this,void 0,void 0,(function*(){try{const e=yield this.getStorageString(`${this.featureFlagIdentifier}_\n        ${o.FEATURE_FLAG_VERSION_DATA_KEY}_`);e&&!isNaN(Number(e))&&(this.putMemoryFeatureFlagVersion(Number(e)),n.DefaultLogger.debug("initFeatureFlagVersion: version = "+e))}catch(e){return n.DefaultLogger.error(e),!1}return!0}))}createDefaultFeatureFlagControlInfo(){return{enableReport:!1,reportInterval:60,rollInterval:600,reportType:"beacon"}}}},"../abc_web_core/lib/index.js":function(e,t,r){"use strict";r.r(t);var n=r("../abc_web_core/lib/logger.js");r.d(t,"Logger",(function(){return n.Logger})),r.d(t,"DefaultLogger",(function(){return n.DefaultLogger}));var o=r("../abc_web_core/lib/sdk_event.js");r.d(t,"SDKEventHandler",(function(){return o.SDKEventHandler}));var i=r("../abc_web_core/lib/constant.js");r.d(t,"FETCH_URL_DEVELOP",(function(){return i.FETCH_URL_DEVELOP})),r.d(t,"FETCH_URL_RELEASE",(function(){return i.FETCH_URL_RELEASE})),r.d(t,"DefaultHttpTimeout",(function(){return i.DefaultHttpTimeout})),r.d(t,"DefaultGrayId",(function(){return i.DefaultGrayId})),r.d(t,"ServerDefaultGrayId",(function(){return i.ServerDefaultGrayId})),r.d(t,"TABBeaconAppKey",(function(){return i.TABBeaconAppKey})),r.d(t,"TabAttaAppId",(function(){return i.TabAttaAppId})),r.d(t,"TabAttaAppToken",(function(){return i.TabAttaAppToken})),r.d(t,"EXP_DATA_KEY",(function(){return i.EXP_DATA_KEY})),r.d(t,"EXP_CONTROL_DATA_KEY",(function(){return i.EXP_CONTROL_DATA_KEY})),r.d(t,"TAB_PROFILE_KEY_PLATFORM",(function(){return i.TAB_PROFILE_KEY_PLATFORM})),r.d(t,"TAB_PROFILE_KEY_RESO",(function(){return i.TAB_PROFILE_KEY_RESO})),r.d(t,"TAB_PROFILE_KEY_PBRAND",(function(){return i.TAB_PROFILE_KEY_PBRAND})),r.d(t,"TAB_PROFILE_KEY_MODEL",(function(){return i.TAB_PROFILE_KEY_MODEL})),r.d(t,"TAB_PROFILE_KEY_PLATFORM_VER",(function(){return i.TAB_PROFILE_KEY_PLATFORM_VER})),r.d(t,"TAB_PROFILE_KEY_OSMODEL",(function(){return i.TAB_PROFILE_KEY_OSMODEL})),r.d(t,"TAB_PROFILE_KEY_SDKVER",(function(){return i.TAB_PROFILE_KEY_SDKVER})),r.d(t,"TAB_SDK_EVENT_RATE",(function(){return i.TAB_SDK_EVENT_RATE})),r.d(t,"TAB_SDK_EVENT_ERROR_INFO",(function(){return i.TAB_SDK_EVENT_ERROR_INFO})),r.d(t,"RESPONSE_SUCCESS_CODE",(function(){return i.RESPONSE_SUCCESS_CODE})),r.d(t,"MIN_REPORT_INTERVAL",(function(){return i.MIN_REPORT_INTERVAL})),r.d(t,"DEFAULT_ROLL_INTERVAL",(function(){return i.DEFAULT_ROLL_INTERVAL})),r.d(t,"DEFAULT_ASSIGNMENT",(function(){return i.DEFAULT_ASSIGNMENT})),r.d(t,"TOGGLE_FETCH_DATA_DEFAULT_VERSION",(function(){return i.TOGGLE_FETCH_DATA_DEFAULT_VERSION})),r.d(t,"TOGGLE_CONTROL_DATA_KEY",(function(){return i.TOGGLE_CONTROL_DATA_KEY})),r.d(t,"TOGGLE_DATA_KEY",(function(){return i.TOGGLE_DATA_KEY})),r.d(t,"TOGGLE_VERSION_DATA_KEY",(function(){return i.TOGGLE_VERSION_DATA_KEY})),r.d(t,"EVENT_NETWORK_HEADER_X_AK",(function(){return i.EVENT_NETWORK_HEADER_X_AK})),r.d(t,"EVENT_NETWORK_HEADER_X_ET",(function(){return i.EVENT_NETWORK_HEADER_X_ET})),r.d(t,"EVENT_NETWORK_HEADER_X_ES",(function(){return i.EVENT_NETWORK_HEADER_X_ES})),r.d(t,"COMMON_EVENT_PARAM_KEY_APP_ID",(function(){return i.COMMON_EVENT_PARAM_KEY_APP_ID})),r.d(t,"COMMON_EVENT_PARAM_KEY_TAB_SDK_VERSION",(function(){return i.COMMON_EVENT_PARAM_KEY_TAB_SDK_VERSION})),r.d(t,"COMMON_EVENT_PARAM_KEY_USER_ID",(function(){return i.COMMON_EVENT_PARAM_KEY_USER_ID})),r.d(t,"EXPOSE_EVENT_PARAM_KEY_REPORT_METHOD",(function(){return i.EXPOSE_EVENT_PARAM_KEY_REPORT_METHOD})),r.d(t,"EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_SDK",(function(){return i.EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_SDK})),r.d(t,"EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_USER",(function(){return i.EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_USER})),r.d(t,"EVENT_PROPERTIES_OS",(function(){return i.EVENT_PROPERTIES_OS})),r.d(t,"EVENT_PROPERTIES_OS_VERSION",(function(){return i.EVENT_PROPERTIES_OS_VERSION})),r.d(t,"EVENT_PROPERTIES_APP_VERSION",(function(){return i.EVENT_PROPERTIES_APP_VERSION})),r.d(t,"EVENT_PROPERTIES_APP_PLATFORM",(function(){return i.EVENT_PROPERTIES_APP_PLATFORM})),r.d(t,"EVENT_PROPERTIES_DEVICE_MODEL",(function(){return i.EVENT_PROPERTIES_DEVICE_MODEL})),r.d(t,"EVENT_PROPERTIES_MANUFACTURER",(function(){return i.EVENT_PROPERTIES_MANUFACTURER})),r.d(t,"EVENT_PROPERTIES_SYSTEM_LANGUAGE",(function(){return i.EVENT_PROPERTIES_SYSTEM_LANGUAGE})),r.d(t,"EVENT_PROPERTIES_NETWORK_TYPE",(function(){return i.EVENT_PROPERTIES_NETWORK_TYPE})),r.d(t,"EVENT_PROPERTIES_IP",(function(){return i.EVENT_PROPERTIES_IP})),r.d(t,"EVENT_PROPERTIES_SCREEN_WIDTH",(function(){return i.EVENT_PROPERTIES_SCREEN_WIDTH})),r.d(t,"EVENT_PROPERTIES_SCREEN_HEIGHT",(function(){return i.EVENT_PROPERTIES_SCREEN_HEIGHT})),r.d(t,"EVENT_PROPERTIES_SCENE",(function(){return i.EVENT_PROPERTIES_SCENE})),r.d(t,"EVENT_PROPERTIES_MG_VERSION",(function(){return i.EVENT_PROPERTIES_MG_VERSION})),r.d(t,"EVENT_PROPERTIES_MG_PLATFORM",(function(){return i.EVENT_PROPERTIES_MG_PLATFORM})),r.d(t,"EVENT_SDK_VERSION",(function(){return i.EVENT_SDK_VERSION})),r.d(t,"EVENT_SDK_PLATFORM",(function(){return i.EVENT_SDK_PLATFORM})),r.d(t,"EVENT_SDK_PLATFORM_DEFAULT_VAL",(function(){return i.EVENT_SDK_PLATFORM_DEFAULT_VAL})),r.d(t,"EVENT_SDK_VERSION_DEFAULT_VAL",(function(){return i.EVENT_SDK_VERSION_DEFAULT_VAL})),r.d(t,"EVENT_USER_DEVICE_ID",(function(){return i.EVENT_USER_DEVICE_ID})),r.d(t,"EVENT_USER_USER_ID",(function(){return i.EVENT_USER_USER_ID})),r.d(t,"FETCH_URL_EVENT_DOMAIN_DEVELOP",(function(){return i.FETCH_URL_EVENT_DOMAIN_DEVELOP})),r.d(t,"FETCH_URL_EVENT_DOMAIN_RELEASE",(function(){return i.FETCH_URL_EVENT_DOMAIN_RELEASE})),r.d(t,"FETCH_EXPOSURE_URL_PATH",(function(){return i.FETCH_EXPOSURE_URL_PATH})),r.d(t,"FETCH_EVENT_URL_PATH",(function(){return i.FETCH_EVENT_URL_PATH})),r.d(t,"FETCH_EVENT_CONTROL_URL_PATH",(function(){return i.FETCH_EVENT_CONTROL_URL_PATH})),r.d(t,"UUID_STROAGE_KEY",(function(){return i.UUID_STROAGE_KEY})),r.d(t,"LOGIN_ID_STROAGE_KEY",(function(){return i.LOGIN_ID_STROAGE_KEY})),r.d(t,"EVENT_COMMON_PROPERTIES_STROAGE_KEY",(function(){return i.EVENT_COMMON_PROPERTIES_STROAGE_KEY}));var a=r("../abc_web_core/lib/model.js");for(var s in a)["default","Logger","DefaultLogger","SDKEventHandler","FETCH_URL_DEVELOP","FETCH_URL_RELEASE","DefaultHttpTimeout","DefaultGrayId","ServerDefaultGrayId","TABBeaconAppKey","TabAttaAppId","TabAttaAppToken","EXP_DATA_KEY","EXP_CONTROL_DATA_KEY","TAB_PROFILE_KEY_PLATFORM","TAB_PROFILE_KEY_RESO","TAB_PROFILE_KEY_PBRAND","TAB_PROFILE_KEY_MODEL","TAB_PROFILE_KEY_PLATFORM_VER","TAB_PROFILE_KEY_OSMODEL","TAB_PROFILE_KEY_SDKVER","TAB_SDK_EVENT_RATE","TAB_SDK_EVENT_ERROR_INFO","RESPONSE_SUCCESS_CODE","MIN_REPORT_INTERVAL","DEFAULT_ROLL_INTERVAL","DEFAULT_ASSIGNMENT","TOGGLE_FETCH_DATA_DEFAULT_VERSION","TOGGLE_CONTROL_DATA_KEY","TOGGLE_DATA_KEY","TOGGLE_VERSION_DATA_KEY","EVENT_NETWORK_HEADER_X_AK","EVENT_NETWORK_HEADER_X_ET","EVENT_NETWORK_HEADER_X_ES","COMMON_EVENT_PARAM_KEY_APP_ID","COMMON_EVENT_PARAM_KEY_TAB_SDK_VERSION","COMMON_EVENT_PARAM_KEY_USER_ID","EXPOSE_EVENT_PARAM_KEY_REPORT_METHOD","EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_SDK","EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_USER","EVENT_PROPERTIES_OS","EVENT_PROPERTIES_OS_VERSION","EVENT_PROPERTIES_APP_VERSION","EVENT_PROPERTIES_APP_PLATFORM","EVENT_PROPERTIES_DEVICE_MODEL","EVENT_PROPERTIES_MANUFACTURER","EVENT_PROPERTIES_SYSTEM_LANGUAGE","EVENT_PROPERTIES_NETWORK_TYPE","EVENT_PROPERTIES_IP","EVENT_PROPERTIES_SCREEN_WIDTH","EVENT_PROPERTIES_SCREEN_HEIGHT","EVENT_PROPERTIES_SCENE","EVENT_PROPERTIES_MG_VERSION","EVENT_PROPERTIES_MG_PLATFORM","EVENT_SDK_VERSION","EVENT_SDK_PLATFORM","EVENT_SDK_PLATFORM_DEFAULT_VAL","EVENT_SDK_VERSION_DEFAULT_VAL","EVENT_USER_DEVICE_ID","EVENT_USER_USER_ID","FETCH_URL_EVENT_DOMAIN_DEVELOP","FETCH_URL_EVENT_DOMAIN_RELEASE","FETCH_EXPOSURE_URL_PATH","FETCH_EVENT_URL_PATH","FETCH_EVENT_CONTROL_URL_PATH","UUID_STROAGE_KEY","LOGIN_ID_STROAGE_KEY","EVENT_COMMON_PROPERTIES_STROAGE_KEY"].indexOf(s)<0&&function(e){r.d(t,e,(function(){return a[e]}))}(s);var E=r("../abc_web_core/lib/utils.js");r.d(t,"encodeParams",(function(){return E.encodeParams})),r.d(t,"createGuid",(function(){return E.createGuid})),r.d(t,"generateExpIds",(function(){return E.generateExpIds})),r.d(t,"compareObject",(function(){return E.compareObject})),r.d(t,"parseAppKeyByEventToken",(function(){return E.parseAppKeyByEventToken})),r.d(t,"generateSignHeader",(function(){return E.generateSignHeader})),r.d(t,"isStringValid",(function(){return E.isStringValid})),r.d(t,"transPropertyObjectToMap",(function(){return E.transPropertyObjectToMap})),r.d(t,"UUID",(function(){return E.UUID}));var _=r("../abc_web_core/lib/experiment/exp_api.js");for(var s in _)["default","Logger","DefaultLogger","SDKEventHandler","FETCH_URL_DEVELOP","FETCH_URL_RELEASE","DefaultHttpTimeout","DefaultGrayId","ServerDefaultGrayId","TABBeaconAppKey","TabAttaAppId","TabAttaAppToken","EXP_DATA_KEY","EXP_CONTROL_DATA_KEY","TAB_PROFILE_KEY_PLATFORM","TAB_PROFILE_KEY_RESO","TAB_PROFILE_KEY_PBRAND","TAB_PROFILE_KEY_MODEL","TAB_PROFILE_KEY_PLATFORM_VER","TAB_PROFILE_KEY_OSMODEL","TAB_PROFILE_KEY_SDKVER","TAB_SDK_EVENT_RATE","TAB_SDK_EVENT_ERROR_INFO","RESPONSE_SUCCESS_CODE","MIN_REPORT_INTERVAL","DEFAULT_ROLL_INTERVAL","DEFAULT_ASSIGNMENT","TOGGLE_FETCH_DATA_DEFAULT_VERSION","TOGGLE_CONTROL_DATA_KEY","TOGGLE_DATA_KEY","TOGGLE_VERSION_DATA_KEY","EVENT_NETWORK_HEADER_X_AK","EVENT_NETWORK_HEADER_X_ET","EVENT_NETWORK_HEADER_X_ES","COMMON_EVENT_PARAM_KEY_APP_ID","COMMON_EVENT_PARAM_KEY_TAB_SDK_VERSION","COMMON_EVENT_PARAM_KEY_USER_ID","EXPOSE_EVENT_PARAM_KEY_REPORT_METHOD","EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_SDK","EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_USER","EVENT_PROPERTIES_OS","EVENT_PROPERTIES_OS_VERSION","EVENT_PROPERTIES_APP_VERSION","EVENT_PROPERTIES_APP_PLATFORM","EVENT_PROPERTIES_DEVICE_MODEL","EVENT_PROPERTIES_MANUFACTURER","EVENT_PROPERTIES_SYSTEM_LANGUAGE","EVENT_PROPERTIES_NETWORK_TYPE","EVENT_PROPERTIES_IP","EVENT_PROPERTIES_SCREEN_WIDTH","EVENT_PROPERTIES_SCREEN_HEIGHT","EVENT_PROPERTIES_SCENE","EVENT_PROPERTIES_MG_VERSION","EVENT_PROPERTIES_MG_PLATFORM","EVENT_SDK_VERSION","EVENT_SDK_PLATFORM","EVENT_SDK_PLATFORM_DEFAULT_VAL","EVENT_SDK_VERSION_DEFAULT_VAL","EVENT_USER_DEVICE_ID","EVENT_USER_USER_ID","FETCH_URL_EVENT_DOMAIN_DEVELOP","FETCH_URL_EVENT_DOMAIN_RELEASE","FETCH_EXPOSURE_URL_PATH","FETCH_EVENT_URL_PATH","FETCH_EVENT_CONTROL_URL_PATH","UUID_STROAGE_KEY","LOGIN_ID_STROAGE_KEY","EVENT_COMMON_PROPERTIES_STROAGE_KEY","encodeParams","createGuid","generateExpIds","compareObject","parseAppKeyByEventToken","generateSignHeader","isStringValid","transPropertyObjectToMap","UUID"].indexOf(s)<0&&function(e){r.d(t,e,(function(){return _[e]}))}(s);var u=r("../abc_web_core/lib/experiment/exp_model.js");for(var s in u)["default","Logger","DefaultLogger","SDKEventHandler","FETCH_URL_DEVELOP","FETCH_URL_RELEASE","DefaultHttpTimeout","DefaultGrayId","ServerDefaultGrayId","TABBeaconAppKey","TabAttaAppId","TabAttaAppToken","EXP_DATA_KEY","EXP_CONTROL_DATA_KEY","TAB_PROFILE_KEY_PLATFORM","TAB_PROFILE_KEY_RESO","TAB_PROFILE_KEY_PBRAND","TAB_PROFILE_KEY_MODEL","TAB_PROFILE_KEY_PLATFORM_VER","TAB_PROFILE_KEY_OSMODEL","TAB_PROFILE_KEY_SDKVER","TAB_SDK_EVENT_RATE","TAB_SDK_EVENT_ERROR_INFO","RESPONSE_SUCCESS_CODE","MIN_REPORT_INTERVAL","DEFAULT_ROLL_INTERVAL","DEFAULT_ASSIGNMENT","TOGGLE_FETCH_DATA_DEFAULT_VERSION","TOGGLE_CONTROL_DATA_KEY","TOGGLE_DATA_KEY","TOGGLE_VERSION_DATA_KEY","EVENT_NETWORK_HEADER_X_AK","EVENT_NETWORK_HEADER_X_ET","EVENT_NETWORK_HEADER_X_ES","COMMON_EVENT_PARAM_KEY_APP_ID","COMMON_EVENT_PARAM_KEY_TAB_SDK_VERSION","COMMON_EVENT_PARAM_KEY_USER_ID","EXPOSE_EVENT_PARAM_KEY_REPORT_METHOD","EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_SDK","EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_USER","EVENT_PROPERTIES_OS","EVENT_PROPERTIES_OS_VERSION","EVENT_PROPERTIES_APP_VERSION","EVENT_PROPERTIES_APP_PLATFORM","EVENT_PROPERTIES_DEVICE_MODEL","EVENT_PROPERTIES_MANUFACTURER","EVENT_PROPERTIES_SYSTEM_LANGUAGE","EVENT_PROPERTIES_NETWORK_TYPE","EVENT_PROPERTIES_IP","EVENT_PROPERTIES_SCREEN_WIDTH","EVENT_PROPERTIES_SCREEN_HEIGHT","EVENT_PROPERTIES_SCENE","EVENT_PROPERTIES_MG_VERSION","EVENT_PROPERTIES_MG_PLATFORM","EVENT_SDK_VERSION","EVENT_SDK_PLATFORM","EVENT_SDK_PLATFORM_DEFAULT_VAL","EVENT_SDK_VERSION_DEFAULT_VAL","EVENT_USER_DEVICE_ID","EVENT_USER_USER_ID","FETCH_URL_EVENT_DOMAIN_DEVELOP","FETCH_URL_EVENT_DOMAIN_RELEASE","FETCH_EXPOSURE_URL_PATH","FETCH_EVENT_URL_PATH","FETCH_EVENT_CONTROL_URL_PATH","UUID_STROAGE_KEY","LOGIN_ID_STROAGE_KEY","EVENT_COMMON_PROPERTIES_STROAGE_KEY","encodeParams","createGuid","generateExpIds","compareObject","parseAppKeyByEventToken","generateSignHeader","isStringValid","transPropertyObjectToMap","UUID"].indexOf(s)<0&&function(e){r.d(t,e,(function(){return u[e]}))}(s);var c=r("../abc_web_core/lib/experiment/exp_info.js");r.d(t,"ExperimentInfo",(function(){return c.ExperimentInfo}));var f=r("../abc_web_core/lib/experiment/exp_fetcher.js");r.d(t,"ExpDataFetcher",(function(){return f.ExpDataFetcher}));var l=r("../abc_web_core/lib/experiment/exp_report_fetcher.js");r.d(t,"ExpReportFetcher",(function(){return l.ExpReportFetcher}));var g=r("../abc_web_core/lib/experiment/exp_storage.js");r.d(t,"ExpDataStorage",(function(){return g.ExpDataStorage}));var p=r("../abc_web_core/lib/experiment/exp_reporter.js");r.d(t,"ExpDataReporter",(function(){return p.ExpDataReporter}));var R=r("../abc_web_core/lib/experiment/exp_component.js");r.d(t,"ExpComponent",(function(){return R.ExpComponent}));var h=r("../abc_web_core/lib/featureflag/feature_flag_api.js");for(var s in h)["default","Logger","DefaultLogger","SDKEventHandler","FETCH_URL_DEVELOP","FETCH_URL_RELEASE","DefaultHttpTimeout","DefaultGrayId","ServerDefaultGrayId","TABBeaconAppKey","TabAttaAppId","TabAttaAppToken","EXP_DATA_KEY","EXP_CONTROL_DATA_KEY","TAB_PROFILE_KEY_PLATFORM","TAB_PROFILE_KEY_RESO","TAB_PROFILE_KEY_PBRAND","TAB_PROFILE_KEY_MODEL","TAB_PROFILE_KEY_PLATFORM_VER","TAB_PROFILE_KEY_OSMODEL","TAB_PROFILE_KEY_SDKVER","TAB_SDK_EVENT_RATE","TAB_SDK_EVENT_ERROR_INFO","RESPONSE_SUCCESS_CODE","MIN_REPORT_INTERVAL","DEFAULT_ROLL_INTERVAL","DEFAULT_ASSIGNMENT","TOGGLE_FETCH_DATA_DEFAULT_VERSION","TOGGLE_CONTROL_DATA_KEY","TOGGLE_DATA_KEY","TOGGLE_VERSION_DATA_KEY","EVENT_NETWORK_HEADER_X_AK","EVENT_NETWORK_HEADER_X_ET","EVENT_NETWORK_HEADER_X_ES","COMMON_EVENT_PARAM_KEY_APP_ID","COMMON_EVENT_PARAM_KEY_TAB_SDK_VERSION","COMMON_EVENT_PARAM_KEY_USER_ID","EXPOSE_EVENT_PARAM_KEY_REPORT_METHOD","EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_SDK","EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_USER","EVENT_PROPERTIES_OS","EVENT_PROPERTIES_OS_VERSION","EVENT_PROPERTIES_APP_VERSION","EVENT_PROPERTIES_APP_PLATFORM","EVENT_PROPERTIES_DEVICE_MODEL","EVENT_PROPERTIES_MANUFACTURER","EVENT_PROPERTIES_SYSTEM_LANGUAGE","EVENT_PROPERTIES_NETWORK_TYPE","EVENT_PROPERTIES_IP","EVENT_PROPERTIES_SCREEN_WIDTH","EVENT_PROPERTIES_SCREEN_HEIGHT","EVENT_PROPERTIES_SCENE","EVENT_PROPERTIES_MG_VERSION","EVENT_PROPERTIES_MG_PLATFORM","EVENT_SDK_VERSION","EVENT_SDK_PLATFORM","EVENT_SDK_PLATFORM_DEFAULT_VAL","EVENT_SDK_VERSION_DEFAULT_VAL","EVENT_USER_DEVICE_ID","EVENT_USER_USER_ID","FETCH_URL_EVENT_DOMAIN_DEVELOP","FETCH_URL_EVENT_DOMAIN_RELEASE","FETCH_EXPOSURE_URL_PATH","FETCH_EVENT_URL_PATH","FETCH_EVENT_CONTROL_URL_PATH","UUID_STROAGE_KEY","LOGIN_ID_STROAGE_KEY","EVENT_COMMON_PROPERTIES_STROAGE_KEY","encodeParams","createGuid","generateExpIds","compareObject","parseAppKeyByEventToken","generateSignHeader","isStringValid","transPropertyObjectToMap","UUID","ExperimentInfo","ExpDataFetcher","ExpReportFetcher","ExpDataStorage","ExpDataReporter","ExpComponent"].indexOf(s)<0&&function(e){r.d(t,e,(function(){return h[e]}))}(s);var T=r("../abc_web_core/lib/featureflag/feature_flag_component.js");r.d(t,"FeatureFlagComponent",(function(){return T.FeatureFlagComponent}));var d=r("../abc_web_core/lib/featureflag/feature_flag_parser.js");r.d(t,"FeatureFlagDataParser",(function(){return d.FeatureFlagDataParser}));var S=r("../abc_web_core/lib/featureflag/feature_flag_model.js");for(var s in S)["default","Logger","DefaultLogger","SDKEventHandler","FETCH_URL_DEVELOP","FETCH_URL_RELEASE","DefaultHttpTimeout","DefaultGrayId","ServerDefaultGrayId","TABBeaconAppKey","TabAttaAppId","TabAttaAppToken","EXP_DATA_KEY","EXP_CONTROL_DATA_KEY","TAB_PROFILE_KEY_PLATFORM","TAB_PROFILE_KEY_RESO","TAB_PROFILE_KEY_PBRAND","TAB_PROFILE_KEY_MODEL","TAB_PROFILE_KEY_PLATFORM_VER","TAB_PROFILE_KEY_OSMODEL","TAB_PROFILE_KEY_SDKVER","TAB_SDK_EVENT_RATE","TAB_SDK_EVENT_ERROR_INFO","RESPONSE_SUCCESS_CODE","MIN_REPORT_INTERVAL","DEFAULT_ROLL_INTERVAL","DEFAULT_ASSIGNMENT","TOGGLE_FETCH_DATA_DEFAULT_VERSION","TOGGLE_CONTROL_DATA_KEY","TOGGLE_DATA_KEY","TOGGLE_VERSION_DATA_KEY","EVENT_NETWORK_HEADER_X_AK","EVENT_NETWORK_HEADER_X_ET","EVENT_NETWORK_HEADER_X_ES","COMMON_EVENT_PARAM_KEY_APP_ID","COMMON_EVENT_PARAM_KEY_TAB_SDK_VERSION","COMMON_EVENT_PARAM_KEY_USER_ID","EXPOSE_EVENT_PARAM_KEY_REPORT_METHOD","EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_SDK","EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_USER","EVENT_PROPERTIES_OS","EVENT_PROPERTIES_OS_VERSION","EVENT_PROPERTIES_APP_VERSION","EVENT_PROPERTIES_APP_PLATFORM","EVENT_PROPERTIES_DEVICE_MODEL","EVENT_PROPERTIES_MANUFACTURER","EVENT_PROPERTIES_SYSTEM_LANGUAGE","EVENT_PROPERTIES_NETWORK_TYPE","EVENT_PROPERTIES_IP","EVENT_PROPERTIES_SCREEN_WIDTH","EVENT_PROPERTIES_SCREEN_HEIGHT","EVENT_PROPERTIES_SCENE","EVENT_PROPERTIES_MG_VERSION","EVENT_PROPERTIES_MG_PLATFORM","EVENT_SDK_VERSION","EVENT_SDK_PLATFORM","EVENT_SDK_PLATFORM_DEFAULT_VAL","EVENT_SDK_VERSION_DEFAULT_VAL","EVENT_USER_DEVICE_ID","EVENT_USER_USER_ID","FETCH_URL_EVENT_DOMAIN_DEVELOP","FETCH_URL_EVENT_DOMAIN_RELEASE","FETCH_EXPOSURE_URL_PATH","FETCH_EVENT_URL_PATH","FETCH_EVENT_CONTROL_URL_PATH","UUID_STROAGE_KEY","LOGIN_ID_STROAGE_KEY","EVENT_COMMON_PROPERTIES_STROAGE_KEY","encodeParams","createGuid","generateExpIds","compareObject","parseAppKeyByEventToken","generateSignHeader","isStringValid","transPropertyObjectToMap","UUID","ExperimentInfo","ExpDataFetcher","ExpReportFetcher","ExpDataStorage","ExpDataReporter","ExpComponent","FeatureFlagComponent","FeatureFlagDataParser"].indexOf(s)<0&&function(e){r.d(t,e,(function(){return S[e]}))}(s);var A=r("../abc_web_core/lib/featureflag/feature_flag_info.js");r.d(t,"ConfigInfo",(function(){return A.ConfigInfo}));var D=r("../abc_web_core/lib/featureflag/feature_flag_fetcher.js");r.d(t,"FeatureFlagDataFetcher",(function(){return D.FeatureFlagDataFetcher}));var O=r("../abc_web_core/lib/featureflag/feature_flag_reporter.js");r.d(t,"FeatureFlagDataReport",(function(){return O.FeatureFlagDataReport}));var P=r("../abc_web_core/lib/featureflag/feature_flag_storage.js");r.d(t,"FeatureFlagDataStorage",(function(){return P.FeatureFlagDataStorage}));var v=r("../abc_web_core/lib/event/event_api.js");for(var s in v)["default","Logger","DefaultLogger","SDKEventHandler","FETCH_URL_DEVELOP","FETCH_URL_RELEASE","DefaultHttpTimeout","DefaultGrayId","ServerDefaultGrayId","TABBeaconAppKey","TabAttaAppId","TabAttaAppToken","EXP_DATA_KEY","EXP_CONTROL_DATA_KEY","TAB_PROFILE_KEY_PLATFORM","TAB_PROFILE_KEY_RESO","TAB_PROFILE_KEY_PBRAND","TAB_PROFILE_KEY_MODEL","TAB_PROFILE_KEY_PLATFORM_VER","TAB_PROFILE_KEY_OSMODEL","TAB_PROFILE_KEY_SDKVER","TAB_SDK_EVENT_RATE","TAB_SDK_EVENT_ERROR_INFO","RESPONSE_SUCCESS_CODE","MIN_REPORT_INTERVAL","DEFAULT_ROLL_INTERVAL","DEFAULT_ASSIGNMENT","TOGGLE_FETCH_DATA_DEFAULT_VERSION","TOGGLE_CONTROL_DATA_KEY","TOGGLE_DATA_KEY","TOGGLE_VERSION_DATA_KEY","EVENT_NETWORK_HEADER_X_AK","EVENT_NETWORK_HEADER_X_ET","EVENT_NETWORK_HEADER_X_ES","COMMON_EVENT_PARAM_KEY_APP_ID","COMMON_EVENT_PARAM_KEY_TAB_SDK_VERSION","COMMON_EVENT_PARAM_KEY_USER_ID","EXPOSE_EVENT_PARAM_KEY_REPORT_METHOD","EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_SDK","EXPOSE_EVENT_PARAM_VALUE_REPORT_METHOD_USER","EVENT_PROPERTIES_OS","EVENT_PROPERTIES_OS_VERSION","EVENT_PROPERTIES_APP_VERSION","EVENT_PROPERTIES_APP_PLATFORM","EVENT_PROPERTIES_DEVICE_MODEL","EVENT_PROPERTIES_MANUFACTURER","EVENT_PROPERTIES_SYSTEM_LANGUAGE","EVENT_PROPERTIES_NETWORK_TYPE","EVENT_PROPERTIES_IP","EVENT_PROPERTIES_SCREEN_WIDTH","EVENT_PROPERTIES_SCREEN_HEIGHT","EVENT_PROPERTIES_SCENE","EVENT_PROPERTIES_MG_VERSION","EVENT_PROPERTIES_MG_PLATFORM","EVENT_SDK_VERSION","EVENT_SDK_PLATFORM","EVENT_SDK_PLATFORM_DEFAULT_VAL","EVENT_SDK_VERSION_DEFAULT_VAL","EVENT_USER_DEVICE_ID","EVENT_USER_USER_ID","FETCH_URL_EVENT_DOMAIN_DEVELOP","FETCH_URL_EVENT_DOMAIN_RELEASE","FETCH_EXPOSURE_URL_PATH","FETCH_EVENT_URL_PATH","FETCH_EVENT_CONTROL_URL_PATH","UUID_STROAGE_KEY","LOGIN_ID_STROAGE_KEY","EVENT_COMMON_PROPERTIES_STROAGE_KEY","encodeParams","createGuid","generateExpIds","compareObject","parseAppKeyByEventToken","generateSignHeader","isStringValid","transPropertyObjectToMap","UUID","ExperimentInfo","ExpDataFetcher","ExpReportFetcher","ExpDataStorage","ExpDataReporter","ExpComponent","FeatureFlagComponent","FeatureFlagDataParser","ConfigInfo","FeatureFlagDataFetcher","FeatureFlagDataReport","FeatureFlagDataStorage"].indexOf(s)<0&&function(e){r.d(t,e,(function(){return v[e]}))}(s);var I=r("../abc_web_core/lib/event/event_storage.js");r.d(t,"EventStorage",(function(){return I.EventStorage}));var N=r("../abc_web_core/lib/event/event_component.js");r.d(t,"EventComponent",(function(){return N.EventComponent}));var F=r("../abc_web_core/lib/event/event_reporter.js");r.d(t,"EventReporter",(function(){return F.EventReporter}));var b=r("../abc_web_core/lib/event/event_fetcher.js");r.d(t,"EventDataFetcher",(function(){return b.EventDataFetcher}));var m=r("../abc_web_core/lib/main_sdk.js");r.d(t,"MainSDK",(function(){return m.MainSDK}))},"../abc_web_core/lib/logger.js":function(e,t,r){"use strict";r.r(t),r.d(t,"Logger",(function(){return n})),r.d(t,"DefaultLogger",(function(){return o}));class n{constructor(){this.method=console.log,this.level=2}setMethod(e){this.method=e}setLevel(e){this.level=e}debug(...e){this.level<=0&&this.method(e)}info(...e){this.level<=1&&this.method(e)}error(...e){this.level<=2&&this.method(e)}}const o=new n},"../abc_web_core/lib/main_sdk.js":function(e,t,r){"use strict";r.r(t),r.d(t,"MainSDK",(function(){return a}));var n=r("../abc_web_core/lib/logger.js"),o=r("../abc_web_core/lib/utils.js"),i=function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{E(n.next(e))}catch(e){i(e)}}function s(e){try{E(n.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}E((n=n.apply(e,t||[])).next())}))};class a{constructor(e){this.isSDKInitial=!1,this.config=e}initSDK(e){return i(this,void 0,void 0,(function*(){this.config=e;return!!(yield this.checkInitParamsValid())&&(this.isSDKInitial=!0,yield this.initComponentImpl())}))}getExpImpl(){return this.expComponent}getFeatureFlagImpl(){return this.featureFlagComponent}getEventImpl(){return this.eventComponent}clear(){this.expComponent&&this.expComponent.clearExperimentSDK(),this.featureFlagComponent&&this.featureFlagComponent.clearFeatureFlagSDK()}refreshExperiment(){return i(this,void 0,void 0,(function*(){let e=!0;return!(this.expComponent&&(e=yield this.expComponent.refreshExperiment(),!e))&&e}))}refreshFeatureFlag(){return i(this,void 0,void 0,(function*(){let e=!0;return!(this.featureFlagComponent&&(e=yield this.featureFlagComponent.refreshFeatureFlag(),!e))&&e}))}checkInitParamsValid(){return i(this,void 0,void 0,(function*(){let e=!0;return this.config||(n.DefaultLogger.error("no param config sdk"),e=!1),this.config.gameId||(n.DefaultLogger.error("gameId not set"),e=!1),this.isSDKInitial&&(n.DefaultLogger.error("sdk already initialized"),e=!1),e}))}initComponentImpl(){var e,t;return i(this,void 0,void 0,(function*(){let r=!1;return this.config?(this.config.enableAutoExposure=null===(e=this.config.enableAutoExposure)||void 0===e||e,this.config.enableAutoPoll=null===(t=this.config.enableAutoPoll)||void 0===t||t,n.DefaultLogger.debug("initComponentImpl start!!"),r=yield this.initEventImpl(),n.DefaultLogger.debug("event initSDKResult = "+r),r=(yield this.initExperimentImpl())&&r,n.DefaultLogger.debug("experiment initSDKResult = "+r),r=(yield this.initFeatureFlagImpl())&&r,n.DefaultLogger.debug("feature flag initSDKResult = "+r),r):r}))}login(e){return!!Object(o.isStringValid)(e)&&(this.config.unitId=e,this.getEventImpl().login(e),!0)}logout(){this.config.unitId&&(this.config.unitId=""),this.getEventImpl().logout()}setCommonProperties(e){this.eventComponent.setCommonProperties(e)}unsetCommonProperty(e){this.eventComponent.unsetCommonProperty(e)}clearCommonProperties(){this.eventComponent.clearCommonProperties()}getCommonProperties(){return this.eventComponent.getCommonProperties()}getDeviceId(){return this.eventComponent.getDeviceId()}logExperimentExposure(e){return this.expComponent.logExperimentExposure(e)}track(e,t){return this.eventComponent.track(e,t)}getExperiment(e,t){return this.getExpImpl().getExperiment(e,t)}getConfig(e){return this.getFeatureFlagImpl().getConfig(e)}getFeatureFlag(e){return this.getFeatureFlagImpl().getConfigByKeys(e)}}},"../abc_web_core/lib/model.js":function(e,t){},"../abc_web_core/lib/sdk_event.js":function(e,t,r){"use strict";r.r(t),r.d(t,"SDKEventHandler",(function(){return n}));class n{constructor(){this.initAll()}onEvent(e,t){const r=this.eventListeners.get(e);r&&r.length>0&&r.forEach(e=>{e(t)})}clear(){this.initAll()}registerEventListener(e,t){if(!t)return!1;const r=this.eventListeners.get(e);return!!r&&(r.push(t),!0)}initAll(){this.eventListeners=new Map,this.eventListeners.set(0,[]),this.eventListeners.set(1,[]),this.eventListeners.set(2,[]),this.eventListeners.set(3,[])}}},"../abc_web_core/lib/utils.js":function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"encodeParams",(function(){return a})),r.d(t,"createGuid",(function(){return s})),r.d(t,"generateExpIds",(function(){return E})),r.d(t,"compareObject",(function(){return _})),r.d(t,"parseAppKeyByEventToken",(function(){return u})),r.d(t,"generateSignHeader",(function(){return c})),r.d(t,"isStringValid",(function(){return f})),r.d(t,"transPropertyObjectToMap",(function(){return l})),r.d(t,"UUID",(function(){return g}));var n=r("../abc_web_core/lib/logger.js"),o=r("../abc_web_core/lib/constant.js"),i=r("../../node_modules/ts-md5/dist/esm/index.js");function a(e){let t="";return Object.keys(e).forEach(r=>{""!==t&&(t+="&"),t+=`${r}=${e[r]}`}),t}function s(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function E(e){if(e){let t="";return e.forEach(e=>{t+=e.expGrayId+"#"}),t}return""}function _(e,t){if(e===t)return!0;if("object"==typeof e&&null!==e&&"object"==typeof t&&null!==t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e){if(!Object.prototype.hasOwnProperty.call(t,r))return!1;if(!_(e[r],t[r]))return!1}return!0}return!1}function u(t){if(!t||0===t.length)return"";const r=t.split(".");if(!r||r.length<3)return n.DefaultLogger.error("parseAppKeyByEventToken eventToken error"),"";const o=r[1];try{const t=e.from(o,"base64").toString("utf-8"),r=JSON.parse(t).tokenName;return n.DefaultLogger.debug(`parseAppKeyByEventToken: appKeyStr=${t}, realAppKey=${r}`),r}catch(e){n.DefaultLogger.error(String(e))}return""}function c(e){const t={};if(!e||0===e.length)return t;const r=u(e),a=Date.parse((new Date).toString()),s=`${e}${r}${a}`;return t[o.EVENT_NETWORK_HEADER_X_AK]=r,t[o.EVENT_NETWORK_HEADER_X_ET]=a,t[o.EVENT_NETWORK_HEADER_X_ES]=i.Md5.hashStr(s),n.DefaultLogger.debug(`generateSignHeader header x-ak=${r}, x-et=${a}`),t}function f(e){return void 0!==e&&""!==e.trim()}function l(e){const t=new Map;if(0===Object.keys(e).length)return t;for(const[r,n]of Object.entries(e)){const e="string"==typeof n?n:JSON.stringify(n);t.set(r,e)}return t}function g(){const e=(new Date).getTime();return`${String(Math.random()).replace(".","").slice(1,11)}-${e}`}}.call(this,r("../../node_modules/buffer/index.js").Buffer)},"./src/ABetterChoice.ts":function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{E(n.next(e))}catch(e){i(e)}}function s(e){try{E(n.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}E((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=r("./src/ABetterChoiceAPI.ts"),i=r("../abc_web_core/lib/index.js");class a{static shareInstance(e){return void 0!==this.instanceMap[e]?this.instanceMap[e]:void 0!==this.defaultInstance?this.defaultInstance:void 0}static init(e){return n(this,void 0,void 0,(function*(){if(null!=this.shareInstance(null==e?void 0:e.gameId))return i.DefaultLogger.debug("has initialed, ignore this init and return previous init sdk object"),this.shareInstance(e.gameId);const t=new o.ABetterChoiceAPI(e);return void 0!==t&&(this.defaultInstance=t,this.instanceMap[e.gameId]=t,yield t.initSDK(e))}))}static login(e,t=""){this.shareInstance(t).login(e)}static logout(e=""){this.shareInstance(e).logout()}static setCommonProperties(e={},t=""){this.shareInstance(t).setCommonProperties(e)}static clearCommonProperties(e=""){this.shareInstance(e).clearCommonProperties()}static unsetCommonProperty(e,t=""){this.shareInstance(t).unsetCommonProperty(e)}static getExperiment(e,t,r=""){return this.shareInstance(r).getExperiment(e,t)}static logExperimentExposure(e,t=""){return this.shareInstance(t).logExperimentExposure(e)}static getConfig(e,t=""){return this.shareInstance(t).getConfig(e)}static track(e,t,r=""){return this.shareInstance(r).track(e,t)}static setLogLevel(e){i.DefaultLogger.setLevel(e)}static getDeviceId(e=""){return this.shareInstance(e).getDeviceId()}}a.instanceMap={},e.exports=a},"./src/ABetterChoiceAPI.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ABetterChoiceAPI=void 0;const n=r("../abc_web_core/lib/index.js"),o=r("./src/experiment/wx_exp_component.ts"),i=r("./src/featureflag/wx_feature_flag_component.ts"),a=r("./src/event/wx_event_component.ts");class s extends n.MainSDK{constructor(e){super(e)}initEventImpl(){return this.eventComponent=new a.WxEventComponent(this.config),this.eventComponent.initEventData()}initExperimentImpl(){return this.expComponent=new o.WxExpComponent(this.config),this.expComponent.initExpData()}initFeatureFlagImpl(){return this.featureFlagComponent=new i.WxFeatureFlagComponent(this.config),this.featureFlagComponent.initFeatureFlagData()}}t.ABetterChoiceAPI=s},"./src/event/wx_event_component.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WxEventComponent=void 0;const n=r("../abc_web_core/lib/index.js"),o=r("./src/event/wx_event_storage.ts"),i=r("./src/event/wx_event_reporter.ts"),a=r("./src/event/wx_event_fetcher.ts"),s=wx;class E extends n.EventComponent{constructor(e){super(e),this.throttleInterval=1e3}initEventReport(){this.eventReporter=new i.WxEventReporter(this.config)}initEventStorage(){this.eventStorage=new o.WxEventStorage(this.config,"1.4.2","abc_wx_sdk")}initEventFetcher(){this.eventFetcher=new a.WxEventFetcher(this.config)}initAutoTrackShow(){n.DefaultLogger.debug("show冷启动事件上报开始"),this.track("$mgShow",{}).then(e=>{n.DefaultLogger.debug("show冷启动事件上报: "+e)}),s.onShow(e=>{n.DefaultLogger.info("show触发事件触发");const t=Date.now();t-this.lastShowTime<this.throttleInterval?n.DefaultLogger.info("show触发事件过于频繁，放弃上报"):this.track("$mgShow",{}).then(e=>{n.DefaultLogger.info("show触发事件上报: "+e),this.lastShowTime=t})})}initAutoTrackHide(){s.onHide(e=>{n.DefaultLogger.info("hide触发事件触发");const t=Date.now();t-this.lastHideTime<this.throttleInterval?n.DefaultLogger.info("hide触发事件过于频繁，放弃上报"):this.track("$mgHide",{}).then(e=>{n.DefaultLogger.info("hide触发事件上报: "+e),this.lastHideTime=t})})}initAutoTrackShare(){const e=this;s.onShareAppMessage((function(t){e.track("$mgShare").then(e=>{n.DefaultLogger.debug("$mgShare track event : "+e)})})),s.onShareTimeline((function(t){e.track("$mgShare").then(e=>{n.DefaultLogger.debug("$mgShare track event : "+e)})}))}initEventHeartTimer(){n.DefaultLogger.debug("start event heart refresh timer report heart event"),setInterval(()=>{n.DefaultLogger.debug("heart事件触发时间: 2min"),this.track("$mgHeart",{}).then(e=>{n.DefaultLogger.info("heart触发事件上报: "+e)})},12e4)}}t.WxEventComponent=E},"./src/event/wx_event_fetcher.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WxEventFetcher=void 0;const n=r("../abc_web_core/lib/event/event_fetcher.js"),o=r("./src/wx_utils.ts");class i extends n.EventDataFetcher{constructor(e){super(e)}sendStringRequestWithStringResponse(e,t,r,n){return o.postReq(e,t,r,n)}}t.WxEventFetcher=i},"./src/event/wx_event_reporter.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WxEventReporter=void 0;const n=r("../abc_web_core/lib/index.js"),o=r("./src/wx_common_network.ts"),i=r("./src/wx_utils.ts");class a extends n.EventReporter{constructor(e){super(e)}sendBytesRequestWithBytesResponse(e,t,r,n){const i={url:e,data:t,headers:r,timeout:n};return o.fetchMpNetwork(i)}sendStringRequestWithStringResponse(e,t,r={},n){return i.postReq(e,t,r,n)}}t.WxEventReporter=a},"./src/event/wx_event_storage.ts":function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{E(n.next(e))}catch(e){i(e)}}function s(e){try{E(n.throw(e))}catch(e){i(e)}}function E(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}E((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.WxEventStorage=void 0;const o=r("../abc_web_core/lib/index.js"),i=wx;class a extends o.EventStorage{constructor(e,t,r){super(e,t,r)}initSystemPropertiesMap(){return n(this,void 0,void 0,(function*(){const e=i.getSystemInfoSync(),t=new Map;t.set(o.EVENT_PROPERTIES_DEVICE_MODEL,e.model),t.set(o.EVENT_PROPERTIES_SCREEN_WIDTH,e.screenWidth),t.set(o.EVENT_PROPERTIES_SCREEN_HEIGHT,e.screenHeight),t.set(o.EVENT_PROPERTIES_MANUFACTURER,e.brand),t.set(o.EVENT_PROPERTIES_OS,e.platform),t.set(o.EVENT_PROPERTIES_OS_VERSION,e.system),t.set(o.EVENT_PROPERTIES_SYSTEM_LANGUAGE,e.language);const r=yield i.getNetworkType();t.set(o.EVENT_PROPERTIES_NETWORK_TYPE,r.networkType);const n=i.getEnterOptionsSync();t.set(o.EVENT_PROPERTIES_SCENE,String(n.scene));const a=i.getAccountInfoSync();return t.set(o.EVENT_PROPERTIES_MG_VERSION,a.miniProgram.version),t.set(o.EVENT_PROPERTIES_MG_PLATFORM,"WXMG"),t}))}getStorageString(e){try{return i.getStorageSync(e)}catch(t){o.DefaultLogger.error(`getStorageData: storageKey: ${e} is error`)}}putStorageString(e,t){try{return i.setStorageSync(e,t)}catch(r){o.DefaultLogger.error(`setStorageData: storageKey: ${e} : ${t} is error`)}}removeStorageString(e){if(void 0!==e&&0!==e.length)try{return i.removeStorageSync(e)}catch(t){o.DefaultLogger.error(`removeStorageSync: storageKey: ${e} is error`)}}getStorageAllKey(){try{return i.getStorageInfoSync().keys}catch(e){o.DefaultLogger.error("getStorageAllKey: "+e)}}}t.WxEventStorage=a},"./src/experiment/wx_exp_component.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WxExpComponent=void 0;const n=r("../abc_web_core/lib/index.js"),o=r("./src/experiment/wx_exp_fetcher.ts"),i=r("./src/experiment/wx_exp_reporter.ts"),a=r("./src/experiment/wx_exp_storage.ts");class s extends n.ExpComponent{constructor(e){super(e)}initExpFetcher(){this.expDataFetcher=new o.WxExpDataFetcher(this.config)}initExpReport(){this.expDataReporter=new i.WxExpReporter(this.config,"1.4.2","abc_wx_sdk")}initExpStorage(){this.expDataStorage=new a.WxExpDataStorage(this.config)}}t.WxExpComponent=s},"./src/experiment/wx_exp_fetcher.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WxExpDataFetcher=void 0;const n=r("../abc_web_core/lib/index.js"),o=r("./src/wx_common_network.ts"),i=r("./src/wx_utils.ts");class a extends n.ExpDataFetcher{constructor(e){super(e)}sendStringRequestWithStringResponse(e,t,r={},n){return i.postReq(e,t,r,n)}sendBytesRequestsWithBytesResponse(e,t,r,n){const i={url:e,data:t,headers:r,timeout:n};return o.fetchMpNetwork(i)}getDeviceId(e){return i.getDeviceId(e)}}t.WxExpDataFetcher=a},"./src/experiment/wx_exp_reporter.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WxExpReporter=void 0;const n=r("../abc_web_core/lib/index.js"),o=r("./src/experiment/wx_exp_reporter_fetcher.ts");class i extends n.ExpDataReporter{constructor(e,t,r){super(e,t,r)}initExpReportFetcher(e){return new o.WxExpReporterFetcher(e,this.sdkVersion,this.sdkPlatform)}}t.WxExpReporter=i},"./src/experiment/wx_exp_reporter_fetcher.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WxExpReporterFetcher=void 0;const n=r("../abc_web_core/lib/index.js"),o=r("./src/wx_common_network.ts"),i=r("./src/wx_utils.ts");class a extends n.ExpReportFetcher{constructor(e,t,r){super(e,t,r)}sendBytesRequestWithBytesResponse(e,t,r,n){const i={url:e,data:t,headers:r,timeout:n};return o.fetchMpNetwork(i)}sendStringRequestWithStringResponse(e,t,r={},n){return i.postReq(e,t,r,n)}getDeviceId(e){return i.getDeviceId(e)}}t.WxExpReporterFetcher=a},"./src/experiment/wx_exp_storage.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WxExpDataStorage=void 0;const n=r("../abc_web_core/lib/index.js"),o=wx||qq;class i extends n.ExpDataStorage{constructor(e){super(e)}getStorageAllKey(){return new Promise(e=>{o.getStorageInfo({success(t){e(t.keys)},fail(){e(null)}})})}getStorageString(e){return new Promise(t=>{o.getStorage({key:e,success(e){t(e.data)},fail(){t(null)}})})}putStorageString(e,t){return new Promise(r=>{o.setStorage({key:e,data:t}),r()})}removeStorageString(e){return new Promise(t=>{o.removeStorage({key:e,success(e){t()},fail(){t(null)}})})}}t.WxExpDataStorage=i},"./src/featureflag/wx_feature_flag_component.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WxFeatureFlagComponent=void 0;const n=r("../abc_web_core/lib/index.js"),o=r("./src/featureflag/wx_feature_flag_fetcher.ts"),i=r("./src/featureflag/wx_feature_flag_reporter.ts"),a=r("./src/featureflag/wx_feature_flag_storage.ts");class s extends n.FeatureFlagComponent{constructor(e,t=""){super(e)}initFeatureFlagFetcher(){this.featureFlagFetcher=new o.WxFeatureFlagDataFetcher(this.config)}initFeatureFlagReporter(){this.featureFlagReporter=new i.WxFeatureFlagReporter(this.config.gameId,this.config.unitId||"")}initFeatureFlagStorage(){this.featureFlagStorage=new a.WxFeatureFlagStorage(this.config)}}t.WxFeatureFlagComponent=s},"./src/featureflag/wx_feature_flag_fetcher.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WxFeatureFlagDataFetcher=void 0;const n=r("../abc_web_core/lib/index.js"),o=r("./src/wx_utils.ts"),i=r("./src/wx_common_network.ts");class a extends n.FeatureFlagDataFetcher{constructor(e){super(e)}sendStringRequestWithStringResponse(e,t,r={},n){return o.postReq(e,t,r,n)}sendBytesRequestWithBytesResponse(e,t,r,n){const o={url:e,data:t,headers:r,timeout:n};return i.fetchMpNetwork(o)}getDeviceId(e){return o.getDeviceId(e)}}t.WxFeatureFlagDataFetcher=a},"./src/featureflag/wx_feature_flag_reporter.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WxFeatureFlagReporter=void 0;const n=r("../abc_web_core/lib/index.js");class o extends n.FeatureFlagDataReport{constructor(e,t){super(e,t)}reportExposureEvent(e,t){return Promise.resolve(void 0)}}t.WxFeatureFlagReporter=o},"./src/featureflag/wx_feature_flag_storage.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WxFeatureFlagStorage=void 0;const n=r("../abc_web_core/lib/index.js"),o=wx;class i extends n.FeatureFlagDataStorage{constructor(e){super(e)}getStorageAllKey(){return new Promise(e=>{o.getStorageInfo({success(t){e(t.keys)},fail(){e(null)}})})}getStorageString(e){return new Promise(t=>{o.getStorage({key:e,success(e){t(e.data)},fail(){t(null)}})})}putStorageString(e,t){return new Promise(r=>{o.setStorage({key:e,data:t,success(){r()},fail(){r()}})})}removeStorageString(e){return new Promise(t=>{o.removeStorage({key:e,success(){t()},fail(){t(null)}})})}}t.WxFeatureFlagStorage=i},"./src/wx_common_network.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fetchMpNetwork=void 0;const n=r("./src/wx_utils.ts"),o=r("../abc_web_core/lib/index.js"),i=wx;t.fetchMpNetwork=function(e){let t={headers:{"Content-Type":"application/json;charset=UTF-8"},method:"POST",responseType:"text"};if(n.isArrayBuffer(e.data.buffer)){const r={headers:Object.assign({},{"Content-Type":"application/proto"},e.headers),responseType:"arraybuffer"};t=Object.assign({},t,r)}const r=Object.assign({},t,e.headers);return o.DefaultLogger.debug(t),new Promise((n,a)=>{i.request({url:e.url,data:e.data,method:"POST",header:r,responseType:"text",timeout:e.timeout,success(e){o.DefaultLogger.debug("fetchMpNetwork response = ",e.data),200===e.statusCode?"arraybuffer"===t.responseType?n(e.data):n(JSON.stringify(e.data)):a(new Error("error network data"))},fail(){o.DefaultLogger.debug("fail"),a()}})})}},"./src/wx_utils.ts":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDeviceId=t.getSystemInfo=t.postReq=t.isArrayBuffer=void 0;const n=r("../abc_web_core/lib/index.js"),o=wx||qq;t.isArrayBuffer=function(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)},t.postReq=function(e,t,r={},n){return new Promise((i,a)=>{const s={url:e,data:t,header:Object.assign({"Content-Type":"application/json;charset=UTF-8"},r),method:"POST",success(e){200===e.statusCode?i(e.data):a(new Error("error http code "+e.statusCode))},fail(){a(new Error("error load net data"))}};n&&n>0&&(s.timeout=n),o.request(s)})},t.getSystemInfo=function(){const e=new Map,t=o.getSystemInfoSync();return e.set("resolution",`${t.screenWidth}*${t.screenHeight}`),e.set("brand",t.brand),e.set("model",t.model),e.set("version",t.version),e.set("SDKVersion",t.SDKVersion),e.set("system",t.system),e},t.getDeviceId=function(e=""){return o.getStorageSync(e+n.UUID_STROAGE_KEY)||""}}});